"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common","star"],function(e,t,i,r,n,s){function a(){e(".loading-mask").addClass("hide"),e(".main-wrap").removeClass("invisibility"),e("footer").removeClass("invisibility")}function o(){n.dao.getCommentDetail({cmId:c,userId:n.util.getUserId()},function(t){var i=n.util.getAdvSource().u,r=n.util.encodeMenuType(n.util.getUvid());i||(i=n.util.getQueryString("u"));var s="";s=i?"?u="+i+"&uvid="+r:"?uvid="+r;var a=n.util.formatProductName(t.productName)+"-d-"+n.util.encodeMenuType(t.productId)+"-"+n.util.encodeMenuType(t.productColorId)+".html"+s;if(e("#product_wrap").attr("href",a),e("#product_image").attr("src",n.util.picUrl+t.productImg),e("#prodcut_name").text(t.productName),e("#prodcut_price").text(t.prodcut_price),t.colorDes&&(e("#color_title").text(t.colorDes),e("#color_title").parent().removeClass("hide")),t.attrDes&&e("#product_attr").text(t.attrDes),t.usrImage?e("#comment_user_image").attr("src",n.util.userIconUrl+t.usrImage):1==t.sex?e("#comment_user_image").attr("src","resources/img/user/user-male.png"):0==t.sex&&e("#comment_user_image").attr("src","resources/img/user/user-female.png"),e("#comment_user_name").text(t.submiter),e("#comment_content").text(t.content),t.shareimgs&&t.shareimgs.length>0)for(var d=0;d<t.shareimgs.length;d++)t.shareimgs[d]=n.util.commentPicUrl+t.shareimgs[d];t.crtime=n.util.formatOrderDateTime(t.crtime);for(var d=0;d<t.zps.length;d++){t.zps[d].crtime=n.util.formatOrderDateTime(t.zps[d].crtime);for(var g=0;g<t.zps[d].shareimgs.length;g++)t.zps[d].shareimgs[g]=n.util.commentPicUrl+t.zps[d].shareimgs[g]}if(sessionStorage.userInfo){var p=JSON.parse(sessionStorage.userInfo);t.userSubmiter=p.email}else t.userSubmiter="";e("#comment_list").html(e("#commentTempl").tmpl([t])),e("#comment_list #color_title").html(e.i18n.map.ColorTitle),e("#comment_list .reply-text").html(e.i18n.map.DetailCommentReply),e("#comment_star_input").each(function(){e(this).rating({step:1,size:"xs",showClear:!1,min:0,max:5,disabled:!0,showCaption:!1}).rating("showStars",t.tEval)}),e("#comment_list .image-wrap img").each(function(){e(this).unbind("click").click(function(){e(this).parent().find("img").removeClass("selected"),e(this).addClass("selected"),u(e(this).parent())})}),l(500),e("#msg_text_area").bind("input propertychange",function(){l(500-e(this).val().length)}),e("#send_msg_btn").unbind("click").click(function(){e("#msg_text_area").val()&&e("#msg_text_area").val().trim()&&n.dao.userLeaveMsg({cmId:c,userId:n.util.getUserId(),msg:e("#msg_text_area").val().trim()},function(){m(),e("#msg_text_area").val(""),l(500)})}),e("#comment_list .prise-item").each(function(){e(this).unbind("click").click(function(){if(n.util.checkIsLogin()){var t=0;e(this).find("i").hasClass("icon-dianzan")&&(t=1),n.dao.userPrise({cmId:Number(e(this).data().data),userId:n.util.getUserId(),type:t},function(){o()})}else{var i=n.util.encodeMenuType(n.util.getUvid());window.location.href="../../../login.html?uvid="+i}})})},null,function(){a()})}function m(){n.dao.getLeaveMsgList({cmId:c},function(t){for(var i=0;i<t.length;i++)t[i].crtime=n.util.formatOrderDateTime(t[i].crtime);e("#msg_list").html(e("#msgTempl").tmpl(t))})}function l(t){var i=e.i18n.map.CommentContentHint;i=i.replace("%",t);var r=i.substring(0,i.indexOf(t)),n=i.substring(i.indexOf(t)+ +(""+t).length,i.length);e("#word_number").html(r+"<span style='color: red;'>"+t+"</span>"+n)}function u(e){d=e.viewer({url:"data-original",toolbar:{zoomIn:!1,zoomOut:!1,oneToOne:!1,reset:!1,prev:{show:!0,size:"large"},play:!1,next:{show:!0,size:"large"},rotateLeft:!1,rotateRight:!1,flipHorizontal:!1,flipVertical:!1},navbar:!1,movable:!0,title:!1,transition:!1,button:!0,hide:function(){e.find("img").removeClass("selected")}})}n.initLoginStatus();var c=n.util.getQueryString("cmId"),d=null;o(),m()});