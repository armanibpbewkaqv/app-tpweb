"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,s,r,t,a){function o(e){if(g)for(var s=0;s<g.length;s++){var r=g[s];if(r.code==e)return r.name}return e}function i(){a.dao.getUserAddress({userId:a.util.getUserId(),addrType:0},function(s){var r=s;if(r&&r.length>0)for(var t=0;t<r.length;t++)if(1==r[t].isDefault){v=r[t];break}v&&(e("#first_name_input").val(v.recFirstname),e("#last_name_input").val(v.recLastname),e("#address_input").val(v.streetAddr),e("#address_2_input").val(v.extendAddr),e("#city_input").val(v.city),e("#postal_code_input").val(v.postCode),e("#email_input").val(v.email),e("#phone_input").val(v.telephone),e("#phone_2_input").val(v.telephone1)),l()},function(){l()})}function n(){var s=a.util.getCouponCode(),r={currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),cart:[],applyCpNo:s,withShipping:1},t=sessionStorage.getItem("input_point");t&&Number(t)>0&&(r.points=Number(t)),a.dao.shoppingCart({inputParams:JSON.stringify(r)},function(s){var r=s.cart;if(r){var t=a.util.getCurrencySymbol(a.util.getLocalCurrency()),o=a.util.getAdvSource().u,i=a.util.encodeMenuType(a.util.getUvid());o||(o=a.util.getQueryString("u"));var n="";n=o?"?u="+o+"&uvid="+i:"?uvid="+i;for(var l=0,d=0;d<r.length;d++){var u=r[d];if(0==Number(u.productNum))r.splice(d,1);else{u.displayImg=a.util.picUrl+u.displayImg,u.cost=a.util.formatProductPrice(u.cost,t),u.unitPrice=a.util.formatProductPrice(u.unitPrice,t),l+=Number(u.productNum);var c=a.util.formatProductName(u.productName)+"-d-"+a.util.encodeMenuType(u.productId)+"-"+a.util.encodeMenuType(u.productColorId)+".html"+n;u.href=c}if(u.subCarts&&u.subCarts.length>0)for(var v=0;v<u.subCarts.length;v++){var g=u.subCarts[v];g.attrDes&&g.attrDes.length>0?g.displayImg=a.util.picUrl+g.displayImg:(u.subCarts.splice(v,1),v-=1)}}e("#cart_list").html(e("#cartTempl").tmpl(r)),e("#cart_list #color_title").html(e.i18n.map.ColorTitle),e("#cart_list .unit-text").html(e.i18n.map.Unit),e("#cart_list .qty-text").html(e.i18n.map.Qty),e("#cart_list .total-text").html(e.i18n.map.Total),m=!0}else m=!1;if(s.dis_info&&s.dis_info.length>0){for(var d=0;d<s.dis_info.length;d++){var C=s.dis_info[d];C.disAmount<0?C.disAmount="-"+a.util.formatProductPrice(-C.disAmount,t):C.disAmount="+"+a.util.formatProductPrice(C.disAmount,t)}e("#dis_info_list").html(e("#disInfoTempl").tmpl(s.dis_info))}e("#sub_total").html(a.util.formatProductPrice(s.amount,t)),e("#grand_total").html(a.util.formatProductPrice(s.realAmount,t)),e("#ship_cost_content").html(a.util.formatProductPrice(s.shippingCost,t)),p=s.amountAllowed,_=s.realAmount;var f=3;sessionStorage.maxnum_allowed&&(f=Number(sessionStorage.maxnum_allowed)),h=l<=f})}function l(){var s=document.getElementById("countryList");v?(c=v.country,a.dao.logJserror({msg:"getCountryList currentAddr",url:"checkout_shipping.html",line:c,col:"",stack:""})):sessionStorage.country_belong?(c=sessionStorage.country_belong,a.dao.logJserror({msg:"getCountryList country_belong",url:"checkout_shipping.html",line:sessionStorage.country_belong,col:c,stack:""})):(c=s.options[0].value,a.dao.logJserror({msg:"getCountryList no country",url:"checkout_shipping.html",line:sessionStorage.userId,col:"",stack:""})),e("#countryList option[value='"+c+"']").prop("selected",!0),e.getJSON("/resources/json/country.json",function(r){g=r;var t=s.value;console.log(t);for(var o=0,i=0;i<r.length;i++){if(r[i].code===t){o=i;break}}if(r&&r[o]&&r[o].state&&r[o].state.length>0)d(r[o].state,!0),e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show(),e(".loading-mask").addClass("hide")}e("#countryList").on("change",function(){var t=e(this).find("option:selected").val();a.dao.logJserror({msg:"countryList change",url:"checkout_shipping.html",line:t,col:c,stack:""}),c=t;var o=s.selectedIndex;if(console.log(o),r&&r[o]&&r[o].state&&r[o].state.length>0)d(r[o].state,!1),e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show()}})})}function d(s,r){if(s&&s.length>0){e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();document.getElementById("provinceList").length=0;for(var t=s,a=0;a<t.length;a++){var o="<option value='"+t[a]+"'>"+t[a]+"</option>";r&&v&&v.province==t[a]&&(o="<option value='"+t[a]+"' selected>"+t[a]+"</option>"),e("#provinceList").append(o)}e(".loading-mask").addClass("hide")}else e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show(),v&&e("#province_input").val(v.province),e(".loading-mask").addClass("hide")}function u(s,r){return!e(s).hasClass("has-error")&&""!==e(s).val().trim()||(e(this).removeClass("has-success"),e(this).addClass("has-error"),e(r).addClass("show-error-text"),!1)}var c,p="",_="",h=!0,m=null,v=null,g=null,C=0;a.initLoginStatus(function(e){if(e)if(sessionStorage.country_belong)i(),n();else var s=setInterval(function(){C++,sessionStorage.country_belong?(clearInterval(s),C=0,i(),n()):C>=3&&(clearInterval(s),C=0,i(),n())},1e3);else window.location.href="../../../login.html"}),function(){e("#save_address_btn").click(function(){var s=!0,r=u("#first_name_input","#error_first_name");s&&((s=r&&s)||e("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");s&&((s=t&&s)||e("#last_name_input").focus());var n=!0,l=a.util.checkAddress();0==l?(e("#address_input").removeClass("has-success"),e("#address_input").addClass("has-error"),e("#error_address").addClass("show-error-text"),n=!1):-1==l?(e("#address_input").removeClass("has-success"),e("#address_input").addClass("has-error"),e("#error_address").addClass("show-error-text"),n=!1):1==l&&(e("#address_input").removeClass("has-error"),e("#address_input").addClass("has-success"),e("#error_address").removeClass("show-error-text")),s&&((s=n&&s)||e("#address_input").focus());var d=u("#city_input","#error_city");s&&((s=d&&s)||e("#city_input").focus());var p=u("#postal_code_input","#error_postal_code");s&&((s=p&&s)||e("#postal_code_input").focus());var _=u("#email_input","#error_email");s&&((s=_&&s)||e("#email_input").focus());var h=u("#phone_input","#error_phone");if(s&&((s=h&&s)||e("#phone_input").focus()),e("#provice_input_wrap").is(":visible")){var m=u("#province_input","#error_province");s&&((s=m&&s)||e("#province_input").focus())}var v=e("#provinceList").val();if(e("#provice_input_wrap").is(":visible")&&(v=e("#province_input").val()),s){var g={userId:a.util.getUserId(),country:c,fullCountry:o(c),province:v,city:e("#city_input").val(),streetAddr:e("#address_input").val(),extendAddr:e("#address_2_input").val(),email:e("#email_input").val().trim(),postCode:e("#postal_code_input").val(),isBillAddr:"0",telephone:e("#phone_input").val(),telephone1:e("#phone_2_input").val(),recFirstname:e("#first_name_input").val(),recLastname:e("#last_name_input").val()};a.dao.addAddress({inputParams:JSON.stringify(g)},function(e){i()}),e("#error_message").html(""),e("#error_message").hide(),e("#save_address_btn").attr("disabled",!0)}}),e("#cancel_save_address_btn").click(function(){e("#choose_shipping_address_wrap").show(),e("#edit_shipping_address_wrap").hide()}),e("#continue_btn, #mobile_continue_btn").click(function(){if(null!=m){if(0==m)return e("#error_message").html(e.i18n.map.EmptyCart),void e("#error_message").show();var s=!0,r=u("#first_name_input","#error_first_name");s&&((s=r&&s)||e("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");s&&((s=t&&s)||e("#last_name_input").focus());var i=!0,n=a.util.checkAddress(e("#address_input").val());0==n?(e("#address_input").removeClass("has-success"),e("#address_input").addClass("has-error"),e("#error_address").addClass("show-error-text"),i=!1):-1==n?(e("#address_input").removeClass("has-success"),e("#address_input").addClass("has-error"),e("#error_address").addClass("show-error-text"),i=!1):1==n&&(e("#address_input").removeClass("has-error"),e("#address_input").addClass("has-success"),e("#error_address").removeClass("show-error-text")),s&&((s=i&&s)||e("#address_input").focus()),i=!0,n=a.util.checkAddress(e("#address_2_input").val()),-1==n?(e("#address_2_input").removeClass("has-success"),e("#address_2_input").addClass("has-error"),e("#error_address_2").addClass("show-error-text"),i=!1):(e("#address_2_input").removeClass("has-error"),e("#address_2_input").addClass("has-success"),e("#error_address_2").removeClass("show-error-text")),s&&((s=i&&s)||e("#address_2_input").focus());var l=u("#city_input","#error_city");s&&((s=l&&s)||e("#city_input").focus());var d=u("#postal_code_input","#error_postal_code");s&&((s=d&&s)||e("#postal_code_input").focus());var g=u("#email_input","#error_email");s&&((s=g&&s)||e("#email_input").focus());var C=u("#phone_input","#error_phone");if(s&&((s=C&&s)||e("#phone_input").focus()),e("#provice_input_wrap").is(":visible")){var f=u("#province_input","#error_province");s&&((s=f&&s)||e("#province_input").focus())}var y=e("#provinceList").val();if(e("#provice_input_wrap").is(":visible")&&(y=e("#province_input").val()),h){if(_>p){var w=a.util.getCurrencySymbol(a.util.getLocalCurrency());e("#error_message").html(e.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(_,w)+" "+e.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(p,w)+". "+e.i18n.map.maxAmountErrorMsg3),e("#error_message").removeClass("hide"),setTimeout(function(){alert(e.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(_,w)+" "+e.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(p,w)+". "+e.i18n.map.maxAmountErrorMsg3)},1),s=!1}}else e("#error_message").html(e.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+e.i18n.map.maxErrorMsg2),e("#error_message").removeClass("hide"),setTimeout(function(){alert(e.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+e.i18n.map.maxErrorMsg2)},1),s=!1;if(s){var b={userId:a.util.getUserId(),country:c,fullCountry:o(c),province:y,city:e("#city_input").val(),streetAddr:e("#address_input").val(),extendAddr:e("#address_2_input").val(),email:e("#email_input").val().trim(),postCode:e("#postal_code_input").val(),telephone:e("#phone_input").val(),telephone1:e("#phone_2_input").val(),recFirstname:e("#first_name_input").val(),recLastname:e("#last_name_input").val()};v&&(b.addrId=v.addrId),e(".loading-mask").removeClass("hide"),e("#error_message").html(""),e("#error_message").hide(),e("#continue_btn").attr("disabled",!0);var x=a.util.getCouponCode(),I="",A="",k=a.util.getAdvSource();k&&(I=k.t,A=k.u);var P={};P=I&&"null"!==I&&"undefined"!==I?{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsType:I,adsAccount:A,memo:e("#memo_text_area").val(),spAddr:b,applyCpNo:x}:{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsAccount:A,memo:e("#memo_text_area").val(),spAddr:b,applyCpNo:x},P.withShipping=1;var S=sessionStorage.getItem("input_point");S&&Number(S)>0&&(P.points=Number(S)),a.dao.newOrder({inputParams:JSON.stringify(P)},function(s){s&&(e(".loading-mask").addClass("hide"),e("#continue_btn").attr("disabled",!1),window.location.href="checkout_payment.html?orderId="+s.orderId,sessionStorage.setItem("couponCode",""))},function(s){e(".loading-mask").addClass("hide"),e("#error_message").html(s.msg),e("#error_message").show(),setTimeout(function(){alert(s.msg)})},function(){e(".loading-mask").addClass("hide"),e("#continue_btn").attr("disabled",!1)})}}}),a.util.isMobile()&&e(window).scroll(function(){a.util.isElementInViewport(document.getElementById("continue_btn"))?e("#mobile_continue_btn").addClass("hide"):e("#mobile_continue_btn").removeClass("hide")})}(),function(){var s=sessionStorage.userInfo;s&&(s=JSON.parse(s),e("#email_input").val(s.email)),e("#first_name_input").blur(function(){var s=a.util.checkNull(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_first_name").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_first_name").removeClass("show-error-text"))}),e("#last_name_input").blur(function(){var s=a.util.checkNull(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_last_name").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_last_name").removeClass("show-error-text"))}),e("#address_input").blur(function(){var s=a.util.checkAddress(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_address").addClass("show-error-text")):-1==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_address").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_address").removeClass("show-error-text"))}),e("#address_2_input").blur(function(){-1==a.util.checkAddress(e(this).val())?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_address_2").addClass("show-error-text")):(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_address_2").removeClass("show-error-text"))}),e("#postal_code_input").blur(function(){var s=a.util.checkNull(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_postal_code").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_postal_code").removeClass("show-error-text"))}),e("#city_input").blur(function(){var s=a.util.checkNull(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_city").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_city").removeClass("show-error-text"))}),e("#province_input").blur(function(){var s=a.util.checkNull(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_province").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_province").removeClass("show-error-text"))}),e("#email_input").blur(function(){var s=a.util.checkEmail(e(this).val().trim());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_email").addClass("show-error-text")):-1==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_email").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_email").removeClass("show-error-text"))}),e("#phone_input").blur(function(){var s=a.util.checkPhone(e(this).val());0==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_phone").addClass("show-error-text")):-1==s?(e(this).removeClass("has-success"),e(this).addClass("has-error"),e("#error_phone").addClass("show-error-text")):1==s&&(e(this).removeClass("has-error"),e(this).addClass("has-success"),e("#error_phone").removeClass("show-error-text"))})}(),function(){a.dao.getChannel({type:1},function(e){e&&sessionStorage.setItem("channelList",JSON.stringify(e))})}(),e(".loading-mask").removeClass("hide"),e("#currency_group").hide()});