"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(s,e,r,t,a){function o(s){if(C)for(var e=0;e<C.length;e++){var r=C[e];if(r.code==s)return r.name}return s}function i(){a.dao.getUserAddress({userId:a.util.getUserId(),addrType:0},function(e){var r=e;if(r&&r.length>0)for(var t=0;t<r.length;t++)if(1==r[t].isDefault){v=r[t];break}v&&(s("#first_name_input").val(v.recFirstname),s("#last_name_input").val(v.recLastname),s("#address_input").val(v.streetAddr),s("#address_2_input").val(v.extendAddr),s("#city_input").val(v.city),s("#postal_code_input").val(v.postCode),s("#email_input").val(v.email),s("#phone_input").val(v.telephone),s("#phone_2_input").val(v.telephone1)),l()},function(){l()})}function n(){var e=a.util.getCouponCode(),r={currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),cart:[],applyCpNo:e,withShipping:1},t=sessionStorage.getItem("input_point");t&&Number(t)>0&&(r.points=Number(t)),a.dao.shoppingCart({inputParams:JSON.stringify(r)},function(e){var r=e.cart;if(r){for(var t=a.util.getCurrencySymbol(a.util.getLocalCurrency()),o=0,i=0;i<r.length;i++){var n=r[i];if(0==Number(n.productNum)?r.splice(i,1):(n.displayImg=a.util.picUrl+n.displayImg,n.cost=a.util.formatProductPrice(n.cost,t),n.unitPrice=a.util.formatProductPrice(n.unitPrice,t),o+=Number(n.productNum)),n.subCarts&&n.subCarts.length>0)for(var l=0;l<n.subCarts.length;l++){var d=n.subCarts[l];d.attrDes&&d.attrDes.length>0?d.displayImg=a.util.picUrl+d.displayImg:(n.subCarts.splice(l,1),l-=1)}}s("#cart_list").html(s("#cartTempl").tmpl(r)),s("#cart_list #color_title").html(s.i18n.map.ColorTitle),s("#cart_list .unit-text").html(s.i18n.map.Unit),s("#cart_list .qty-text").html(s.i18n.map.Qty),s("#cart_list .total-text").html(s.i18n.map.Total),m=!0}else m=!1;if(e.dis_info&&e.dis_info.length>0){for(var i=0;i<e.dis_info.length;i++){var u=e.dis_info[i];u.disAmount<0?u.disAmount="-"+a.util.formatProductPrice(-u.disAmount,t):u.disAmount="+"+a.util.formatProductPrice(u.disAmount,t)}s("#dis_info_list").html(s("#disInfoTempl").tmpl(e.dis_info))}s("#sub_total").html(a.util.formatProductPrice(e.amount,t)),s("#grand_total").html(a.util.formatProductPrice(e.realAmount,t)),s("#ship_cost_content").html(a.util.formatProductPrice(e.shippingCost,t)),_=e.amountAllowed,p=e.realAmount;var c=3;sessionStorage.maxnum_allowed&&(c=Number(sessionStorage.maxnum_allowed)),h=o<=c})}function l(){var e=document.getElementById("countryList");v?(c=v.country,a.dao.logJserror({msg:"getCountryList currentAddr",url:"checkout_shipping.html",line:c,col:"",stack:""})):sessionStorage.country_belong?(c=sessionStorage.country_belong,a.dao.logJserror({msg:"getCountryList country_belong",url:"checkout_shipping.html",line:sessionStorage.country_belong,col:c,stack:""})):(c=e.options[0].value,a.dao.logJserror({msg:"getCountryList no country",url:"checkout_shipping.html",line:sessionStorage.userId,col:"",stack:""})),s("#countryList option[value='"+c+"']").prop("selected",!0),s.getJSON("/resources/json/country.json",function(r){C=r;var t=e.value;console.log(t);for(var o=0,i=0;i<r.length;i++){if(r[i].code===t){o=i;break}}if(r&&r[o]&&r[o].state&&r[o].state.length>0)d(r[o].state,!0),s("#provice_selected_wrap").show(),s("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,s("#provice_selected_wrap").hide(),s("#provice_input_wrap").show(),s(".loading-mask").addClass("hide")}s("#countryList").on("change",function(){var t=s(this).find("option:selected").val();a.dao.logJserror({msg:"countryList change",url:"checkout_shipping.html",line:t,col:c,stack:""}),c=t;var o=e.selectedIndex;if(console.log(o),r&&r[o]&&r[o].state&&r[o].state.length>0)d(r[o].state,!1),s("#provice_selected_wrap").show(),s("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,s("#provice_selected_wrap").hide(),s("#provice_input_wrap").show()}})})}function d(e,r){if(e&&e.length>0){s("#provice_selected_wrap").show(),s("#provice_input_wrap").hide();document.getElementById("provinceList").length=0;for(var t=e,a=0;a<t.length;a++){var o="<option value='"+t[a]+"'>"+t[a]+"</option>";r&&v&&v.province==t[a]&&(o="<option value='"+t[a]+"' selected>"+t[a]+"</option>"),s("#provinceList").append(o)}s(".loading-mask").addClass("hide")}else s("#provice_selected_wrap").hide(),s("#provice_input_wrap").show(),v&&s("#province_input").val(v.province),s(".loading-mask").addClass("hide")}function u(e,r){return!s(e).hasClass("has-error")&&""!==s(e).val().trim()||(s(this).removeClass("has-success"),s(this).addClass("has-error"),s(r).addClass("show-error-text"),!1)}var c,_="",p="",h=!0,m=null,v=null,C=null,g=0;a.initLoginStatus(function(s){if(s)if(sessionStorage.country_belong)i(),n();else var e=setInterval(function(){g++,sessionStorage.country_belong?(clearInterval(e),g=0,i(),n()):g>=3&&(clearInterval(e),g=0,i(),n())},1e3);else window.location.href="../../../login.html"}),function(){s("#save_address_btn").click(function(){var e=!0,r=u("#first_name_input","#error_first_name");e&&((e=r&&e)||s("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");e&&((e=t&&e)||s("#last_name_input").focus());var n=!0,l=a.util.checkAddress();0==l?(s("#address_input").removeClass("has-success"),s("#address_input").addClass("has-error"),s("#error_address").addClass("show-error-text"),n=!1):-1==l?(s("#address_input").removeClass("has-success"),s("#address_input").addClass("has-error"),s("#error_address").addClass("show-error-text"),n=!1):1==l&&(s("#address_input").removeClass("has-error"),s("#address_input").addClass("has-success"),s("#error_address").removeClass("show-error-text")),e&&((e=n&&e)||s("#address_input").focus());var d=u("#city_input","#error_city");e&&((e=d&&e)||s("#city_input").focus());var _=u("#postal_code_input","#error_postal_code");e&&((e=_&&e)||s("#postal_code_input").focus());var p=u("#email_input","#error_email");e&&((e=p&&e)||s("#email_input").focus());var h=u("#phone_input","#error_phone");if(e&&((e=h&&e)||s("#phone_input").focus()),s("#provice_input_wrap").is(":visible")){var m=u("#province_input","#error_province");e&&((e=m&&e)||s("#province_input").focus())}var v=s("#provinceList").val();if(s("#provice_input_wrap").is(":visible")&&(v=s("#province_input").val()),e){var C={userId:a.util.getUserId(),country:c,fullCountry:o(c),province:v,city:s("#city_input").val(),streetAddr:s("#address_input").val(),extendAddr:s("#address_2_input").val(),email:s("#email_input").val().trim(),postCode:s("#postal_code_input").val(),isBillAddr:"0",telephone:s("#phone_input").val(),telephone1:s("#phone_2_input").val(),recFirstname:s("#first_name_input").val(),recLastname:s("#last_name_input").val()};a.dao.addAddress({inputParams:JSON.stringify(C)},function(s){i()}),s("#error_message").html(""),s("#error_message").hide(),s("#save_address_btn").attr("disabled",!0)}}),s("#cancel_save_address_btn").click(function(){s("#choose_shipping_address_wrap").show(),s("#edit_shipping_address_wrap").hide()}),s("#continue_btn, #mobile_continue_btn").click(function(){if(null!=m){if(0==m)return s("#error_message").html(s.i18n.map.EmptyCart),void s("#error_message").show();var e=!0,r=u("#first_name_input","#error_first_name");e&&((e=r&&e)||s("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");e&&((e=t&&e)||s("#last_name_input").focus());var i=!0,n=a.util.checkAddress(s("#address_input").val());0==n?(s("#address_input").removeClass("has-success"),s("#address_input").addClass("has-error"),s("#error_address").addClass("show-error-text"),i=!1):-1==n?(s("#address_input").removeClass("has-success"),s("#address_input").addClass("has-error"),s("#error_address").addClass("show-error-text"),i=!1):1==n&&(s("#address_input").removeClass("has-error"),s("#address_input").addClass("has-success"),s("#error_address").removeClass("show-error-text")),e&&((e=i&&e)||s("#address_input").focus()),i=!0,n=a.util.checkAddress(s("#address_2_input").val()),-1==n?(s("#address_2_input").removeClass("has-success"),s("#address_2_input").addClass("has-error"),s("#error_address_2").addClass("show-error-text"),i=!1):(s("#address_2_input").removeClass("has-error"),s("#address_2_input").addClass("has-success"),s("#error_address_2").removeClass("show-error-text")),e&&((e=i&&e)||s("#address_2_input").focus());var l=u("#city_input","#error_city");e&&((e=l&&e)||s("#city_input").focus());var d=u("#postal_code_input","#error_postal_code");e&&((e=d&&e)||s("#postal_code_input").focus());var C=u("#email_input","#error_email");e&&((e=C&&e)||s("#email_input").focus());var g=u("#phone_input","#error_phone");if(e&&((e=g&&e)||s("#phone_input").focus()),s("#provice_input_wrap").is(":visible")){var f=u("#province_input","#error_province");e&&((e=f&&e)||s("#province_input").focus())}var w=s("#provinceList").val();if(s("#provice_input_wrap").is(":visible")&&(w=s("#province_input").val()),h){if(p>_){var y=a.util.getCurrencySymbol(a.util.getLocalCurrency());s("#error_message").html(s.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(p,y)+" "+s.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(_,y)+". "+s.i18n.map.maxAmountErrorMsg3),s("#error_message").removeClass("hide"),setTimeout(function(){alert(s.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(p,y)+" "+s.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(_,y)+". "+s.i18n.map.maxAmountErrorMsg3)},1),e=!1}}else s("#error_message").html(s.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+s.i18n.map.maxErrorMsg2),s("#error_message").removeClass("hide"),setTimeout(function(){alert(s.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+s.i18n.map.maxErrorMsg2)},1),e=!1;if(e){var b={userId:a.util.getUserId(),country:c,fullCountry:o(c),province:w,city:s("#city_input").val(),streetAddr:s("#address_input").val(),extendAddr:s("#address_2_input").val(),email:s("#email_input").val().trim(),postCode:s("#postal_code_input").val(),telephone:s("#phone_input").val(),telephone1:s("#phone_2_input").val(),recFirstname:s("#first_name_input").val(),recLastname:s("#last_name_input").val()};v&&(b.addrId=v.addrId),s(".loading-mask").removeClass("hide"),s("#error_message").html(""),s("#error_message").hide(),s("#continue_btn").attr("disabled",!0);var x=a.util.getCouponCode(),I="",k="",A=a.util.getAdvSource();A&&(I=A.t,k=A.u);var P={};P=I&&"null"!==I&&"undefined"!==I?{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsType:I,adsAccount:k,memo:s("#memo_text_area").val(),spAddr:b,applyCpNo:x}:{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsAccount:k,memo:s("#memo_text_area").val(),spAddr:b,applyCpNo:x},P.withShipping=1;var S=sessionStorage.getItem("input_point");S&&Number(S)>0&&(P.points=Number(S)),a.dao.newOrder({inputParams:JSON.stringify(P)},function(e){e&&(s(".loading-mask").addClass("hide"),s("#continue_btn").attr("disabled",!1),window.location.href="checkout_payment.html?orderId="+e.orderId,sessionStorage.setItem("couponCode",""))},function(e){s(".loading-mask").addClass("hide"),s("#error_message").html(e.msg),s("#error_message").show(),setTimeout(function(){alert(e.msg)})},function(){s(".loading-mask").addClass("hide"),s("#continue_btn").attr("disabled",!1)})}}}),a.util.isMobile()&&s(window).scroll(function(){a.util.isElementInViewport(document.getElementById("continue_btn"))?s("#mobile_continue_btn").addClass("hide"):s("#mobile_continue_btn").removeClass("hide")})}(),function(){var e=sessionStorage.userInfo;e&&(e=JSON.parse(e),s("#email_input").val(e.email)),s("#first_name_input").blur(function(){var e=a.util.checkNull(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_first_name").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_first_name").removeClass("show-error-text"))}),s("#last_name_input").blur(function(){var e=a.util.checkNull(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_last_name").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_last_name").removeClass("show-error-text"))}),s("#address_input").blur(function(){var e=a.util.checkAddress(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_address").addClass("show-error-text")):-1==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_address").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_address").removeClass("show-error-text"))}),s("#address_2_input").blur(function(){-1==a.util.checkAddress(s(this).val())?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_address_2").addClass("show-error-text")):(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_address_2").removeClass("show-error-text"))}),s("#postal_code_input").blur(function(){var e=a.util.checkNull(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_postal_code").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_postal_code").removeClass("show-error-text"))}),s("#city_input").blur(function(){var e=a.util.checkNull(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_city").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_city").removeClass("show-error-text"))}),s("#province_input").blur(function(){var e=a.util.checkNull(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_province").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_province").removeClass("show-error-text"))}),s("#email_input").blur(function(){var e=a.util.checkEmail(s(this).val().trim());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_email").addClass("show-error-text")):-1==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_email").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_email").removeClass("show-error-text"))}),s("#phone_input").blur(function(){var e=a.util.checkPhone(s(this).val());0==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_phone").addClass("show-error-text")):-1==e?(s(this).removeClass("has-success"),s(this).addClass("has-error"),s("#error_phone").addClass("show-error-text")):1==e&&(s(this).removeClass("has-error"),s(this).addClass("has-success"),s("#error_phone").removeClass("show-error-text"))})}(),function(){a.dao.getChannel({type:1},function(s){s&&sessionStorage.setItem("channelList",JSON.stringify(s))})}(),s(".loading-mask").removeClass("hide"),s("#currency_group").hide()});