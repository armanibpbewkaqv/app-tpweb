"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common","star"],function(e,t,s,i,r,a){function n(t){t&&t.usrico?r.util.setUserImage(e("#sex_image"),t.usrico):"0"==t.sex?e("#sex_image").attr("src","resources/img/user/user-female.png"):"1"==t.sex&&e("#sex_image").attr("src","resources/img/user/user-female.png")}function o(e){switch(e){case"menu_my_order":l();break;case"menu_my_cart":d();break;case"menu_my_fav":c();break;case"menu_my_coupon":m();break;case"menu_my_address":u();break;case"menu_account_setting":_();break;case"menu_my_browse":M();break;case"menu_my_comment":L();break;case"menu_my_message":window.location.href="../../../my_message.html";break;case"menu_my_points":window.location.href="../../../my_point.html"}}function l(){document.title=e.i18n.map.MyOrderTitle,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").show(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide(),f()}function d(){document.title=e.i18n.map.MyCartTitle,e("#order_list_wrap").hide(),e("#cart_list_wrap").show(),e("#fav_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide(),w()}function c(){document.title=e.i18n.map.MyFavTitle,e("#fav_list_wrap").show(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide(),b()}function m(){document.title=e.i18n.map.MyCouponTitle,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").show(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide(),S()}function u(){document.title=e.i18n.map.MyAddressTitle,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").show(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide(),v(),p()}function _(){document.title=e.i18n.map.MyAccountSettingTitle,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").show(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").hide();var t=sessionStorage.getItem("userInfo");if(t){t=JSON.parse(t),e("#account_setting_first_name_input").val(t.firstName),e("#account_setting_last_name_input").val(t.lastName),e("#account_setting_email_input").val(t.email),e("#email_verify_email_input").val(t.email),t.ev&&"0"!=t.ev?(e("#verify_email").text(e.i18n.map.Verifyed),document.getElementById("verify_email").disabled=!0):(document.getElementById("verify_email").disabled=!1,e("#verify_email").text(e.i18n.map.VerifyBtn));for(var s=document.getElementsByName("gender"),i=0;i<s.length;i++)s[i].value==t.sex&&(s[i].checked=!0)}}function p(){r.dao.getUserAddress({userId:r.util.getUserId(),addrType:1},function(t){var s=t;s&&s.length>0?(e("#billing_address_list").html(e("#addressItemTempl").tmpl(s)),e("#billing_address_list li #phone_number_label").text(e.i18n.map.PhoneNumberlabel),e("#billing_address_list li .button-wrap button:nth-child(1)").text(e.i18n.map.Edit),e("#billing_address_list li .button-wrap button:nth-child(2)").text(e.i18n.map.Delete),e("#billing_address_list li .button-wrap button").click(function(){h(s,e(this),function(){v()})}),e("#billing_address_list").show(),e("#billing_address_empty_wrap").hide()):(e("#billing_address_list").hide(),e("#billing_address_empty_wrap").show())})}function h(t,s,i){if("edit"==s[0].id){e(".edit-address-mask").removeClass("hide");var a=s.parent().parent().data().data;E=t[a],console.log("currentAddr = "+E),e("#first_name_input").val(E.recFirstname),e("#last_name_input").val(E.recLastname),e("#address_input").val(E.streetAddr),e("#address_2_input").val(E.extendAddr),e("#city_input").val(E.city),e("#postal_code_input").val(E.postCode),e("#email_input").val(E.email),e("#phone_input").val(E.telephone),e("#phone_2_input").val(E.telephone1),1==E.isDefault?e("#default_input").attr("checked",!0):e("#default_input").attr("checked",!1),N(E.country,E.fullCountry)}else r.dao.delAddress({addrId:s.data().data},function(e){console.log("删除成功"),i()})}function v(){r.dao.getUserAddress({userId:r.util.getUserId(),addrType:0},function(t){var s=t;s&&s.length>0?(e("#shipping_address_list").html(e("#addressItemTempl").tmpl(s)),e("#shipping_address_list li #phone_number_label").text(e.i18n.map.PhoneNumberlabel),e("#shipping_address_list li .button-wrap button:nth-child(1)").text(e.i18n.map.Edit),e("#shipping_address_list li .button-wrap button:nth-child(2)").text(e.i18n.map.Delete),e("#shipping_address_list li .button-wrap button").click(function(){h(s,e(this),function(){v()})}),e("#shipping_address_list").show(),e("#shipping_address_empty_wrap").hide()):(e("#shipping_address_list").hide(),e("#shipping_address_empty_wrap").show())})}function f(){var t=r.util.getAdvSource().u,s=r.util.encodeMenuType(r.util.getUvid());t||(t=r.util.getQueryString("u"));var i="";i=t?"?u="+t+"&uvid="+s:"?uvid="+s,r.dao.getUserOrder({userId:r.util.getUserId(),type:"0"},function(t){var s=t;if(s&&s.length>0){for(var a=0;a<s.length;a++){var n=s[a],o=r.util.getCurrencySymbol(n.correncyCode);o||(o=r.util.getCurrencySymbol(r.util.getLocalCurrency())),n.realCost=r.util.formatProductPrice(n.realCost,o),n.totalCost=r.util.formatProductPrice(n.totalCost,o),0==n.paymentStatus?n.paymentStatusString=e.i18n.map.OrderStatusPendding:1==n.paymentStatus?n.paymentStatusString=e.i18n.map.OrderStatusSuccess:2==n.paymentStatus?n.paymentStatusString=e.i18n.map.OrderStatusFail:3==n.paymentStatus?n.paymentStatusString=e.i18n.map.OrderStatusDelay:4==n.paymentStatus&&(n.paymentStatusString=e.i18n.map.OrderStatusDelivered),n.crTimeString=r.util.formatOrderDateTime(n.crTime);for(var l=0;l<n.spCart.length;l++){var d=n.spCart[l];if(d.mainImgpath=r.util.picUrl+d.mainImgpath,"2"==d.attrFlg){var c=r.util.formatProductName(d.productName)+"-d-"+r.util.encodeMenuType(d.productId)+"-"+r.util.encodeMenuType(d.productColorId)+".html"+i;d.href=c}else{var c=r.util.formatProductName(d.productName)+"-d-"+r.util.encodeMenuType(d.productId)+"-"+r.util.encodeMenuType(d.productColorId)+".html"+i;d.href=c}if(d.subCarts&&d.subCarts.length>0)for(var m=0;m<d.subCarts.length;m++){var u=d.subCarts[m];u.attrDes&&u.attrDes.length>0?u.colorImgpath=r.util.picUrl+u.colorImgpath:(d.subCarts.splice(m,1),m-=1)}}n.customServiceUrl="../../../my_message.html?index=2&orderId="+n.orderId,n.cfaddrStatus&&"0"==n.cfaddrStatus?n.cfaddrStatusString=e.i18n.map.ConfirmAddrBtn:n.cfaddrStatus&&"1"==n.cfaddrStatus?n.cfaddrStatusString=e.i18n.map.ConfirmedAddrBtn:n.cfaddrStatus&&"2"==n.cfaddrStatus&&(n.cfaddrStatusString=e.i18n.map.ConfirmedAddrExpiredBtn)}e("#order_item_list").html(e("#orderItemTempl").tmpl(s)),e("#order_item_list #color_title").html(e.i18n.map.ColorTitle),e("#order_item_list .order-number").html(e.i18n.map.OrderNumber),e("#order_item_list .order-detail").html(e.i18n.map.OrderDetails),e("#order_item_list #ViewLogistics").html(e.i18n.map.ViewLogistics),e("#order_item_list #ContinuePayment").html(e.i18n.map.ContinuePayment),e("#order_item_list #cancelOrderBtn").html(e.i18n.map.CancelOrder),e("#order_item_list #deleteOrderBtn").html(e.i18n.map.DeleteOrder),e("#order_item_list #BuyAgain").html(e.i18n.map.BuyAgain),sessionStorage.commentSwitch&&"1"==sessionStorage.commentSwitch?(e("#order_item_list #ToCommnet").html(e.i18n.map.ToCommnet),e("#order_item_list #ToCommnet").removeClass("hide"),e("#order_item_list #AdditionalCommnet").html(e.i18n.map.AdditionalCommnet),e("#order_item_list #AdditionalCommnet").removeClass("hide")):(e("#order_item_list #ToCommnet").addClass("hide"),e("#order_item_list #AdditionalCommnet").addClass("hide")),sessionStorage.messageSwitch&&"1"==sessionStorage.messageSwitch?(e("#order_item_list #CustomServiceBtn").html(e.i18n.map.CustomServiceBtn),e("#order_item_list #CustomServiceBtn").parent().removeClass("hide")):e("#order_item_list #CustomServiceBtn").parent().addClass("hide"),e("#order_item_list").show(),e("#order_empty_wrap").hide(),e("#order_item_list #BuyAgain").each(function(){e(this).unbind().click(function(){e(".loading-mask").removeClass("hide");var t=e(this).data().data,i=s[t].spCart;r.dao.merge2cart({inputParams:JSON.stringify(i)},function(){window.location.href="../../../shopping_cart.html"},null,function(){e(".loading-mask").addClass("hide")})})}),e("#order_item_list #ToConfirmAddrBtn").each(function(){e(this).unbind().click(function(){var t=e(this).data().data;"0"==s[t].cfaddrStatus&&(Q=s[t].orderId,y(Q))})}),e("#order_item_list #cancelOrderBtn").each(function(){e(this).unbind().click(function(){if(window.confirm("Are you sure to cancel the order?")){var t=e(this).data().data,i=s[t].orderId;r.dao.cancelOrder({orderId:i,userId:r.util.getUserId(),type:0},function(e){f()})}})}),e("#order_item_list #deleteOrderBtn").each(function(){e(this).unbind().click(function(){if(window.confirm("Are you sure to delete the order?")){var t=e(this).data().data,i=s[t].orderId;r.dao.cancelOrder({orderId:i,userId:r.util.getUserId(),type:1},function(e){f()})}})})}else e("#order_item_list").hide(),e("#order_empty_wrap").show()})}function y(t){r.dao.getOrderDetail({orderId:t},function(t){if("0"==t.cfaddrStatus){e("#confirm_address_mask").removeClass("hide");var s=t.shippingAddr;if(s){var i=s.recFirstname+s.recLastname,r=s.telephone,a=s.streetAddr+" "+s.extendAddr+" "+s.city+", "+s.province+" "+s.postCode+", "+s.fullCountry;e("#order_detail_name").html(i),e("#order_mobile_name").html(r),e("#order_address_name").html(a)}else f()}else f()})}function g(){r.dao.upcfAddrStatus({orderId:Q,status:"1"},function(t){Q=null,f(),e("#confirm_address_mask").addClass("hide")})}function w(){var t={currencyId:r.util.getLocalCurrency(),userId:r.util.getUserId(),cart:[],applyCpNo:r.util.getCouponCode()};r.dao.shoppingCart({inputParams:JSON.stringify(t)},function(t){if(t.cart&&t.cart.length>0){var s=0,i=r.util.getCurrencySymbol(r.util.getLocalCurrency()),a=r.util.getAdvSource().u,n=r.util.encodeMenuType(r.util.getUvid());a||(a=r.util.getQueryString("u"));var o="";o=a?"?u="+a+"&uvid="+n:"?uvid="+n;for(var l=0;l<t.cart.length;l++){var d=t.cart[l];d.displayImg=r.util.picUrl+d.displayImg,d.cost=r.util.formatProductPrice(d.cost,i);var c=r.util.formatProductName(d.productName)+"-d-"+r.util.encodeMenuType(d.productId)+"-"+r.util.encodeMenuType(d.productColorId)+".html"+o;d.href=c,s+=Number(d.productNum)}e("#cart_list").html(e("#cartTempl").tmpl(t.cart)),e("#cart_list #color_title").html(e.i18n.map.ColorTitle),e("#cart_list #remove_label").html(e.i18n.map.Remove),s>0?(e("#cart_product_number").html(s),e("#cart_product_number").show(),e("#mb_cart_product_number").html(s),e("#mb_cart_product_number").show()):(e("#cart_product_number").html("0"),e("#cart_product_number").show(),e("#mb_cart_product_number").html("0"),e("#mb_cart_product_number").show());for(var m=["1","2","3","4","5"],l=0;l<t.cart.length;l++){var u=e("#qtyItemTempl").tmpl(m);e("#"+l).find(".dropdown-menu").html(u),e("#"+l+" .dropdown-menu li").each(function(s){e(this).click(function(){var i=m[s],r=e(this).parent().parent().parent().parent()[0].id;e("#"+r).find("#qty_content").html(i),C(e(this).parent().parent().parent().parent().data().data,i,t)})}),e("#"+l+" .remove-btn").each(function(){e(this).click(function(){console.log("del "+e(this).parent().parent().data().data+"item"),C(e(this).parent().parent().parent().parent().data().data,0,t)})})}}else e("#cart_list").hide(),e("#cart_empty_wrap").show(),e("#cart_product_number").html("0"),e("#cart_product_number").show(),e("#mb_cart_product_number").html("0"),e("#mb_cart_product_number").show()},function(){e("#cart_list").hide(),e("#cart_empty_wrap").show()})}function C(e,t,s){if(console.log("changeProductNumber"),r.util.checkIsLogin()){var i=s.cart[e];i.productNum=Number(t),i.userId=r.util.getUserId(),r.dao.shoppingCartMt({inputParams:JSON.stringify([i])},function(e){w()})}else if(localStorage.productList){var a=JSON.parse(localStorage.productList);if(0==Number(t))a.splice(e,1);else{var i=a[e];i.productNum=Number(t)}localStorage.setItem("productList",JSON.stringify(a)),w()}}function b(){r.dao.getUserExtInfo({userId:r.util.getUserId(),currencyId:r.util.getLocalCurrency(),type:"2"},function(t){var s=t.attention.products;if(s&&s.length>0){var i=r.util.getCurrencySymbol(r.util.getLocalCurrency()),a=r.util.getAdvSource().u,n=r.util.encodeMenuType(r.util.getUvid());a||(a=r.util.getQueryString("u"));var o="";o=a?"?u="+a+"&uvid="+n:"?uvid="+n;for(var l=0;l<s.length;l++){var d=s[l];d.orgPrice=r.util.formatProductPrice(d.orgPrice,i),d.curPrice=r.util.formatProductPrice(d.curPrice,i),d.imgDisplay=r.util.picUrl+d.imgDisplay;var c=r.util.formatProductName(d.productName)+"-d-"+r.util.encodeMenuType(d.productId)+"-"+r.util.encodeMenuType(d.productColorId)+".html"+o;d.href=c}e("#fav_item_list").html(e("#favItemTempl").tmpl(s)),e("#fav_item_list .icon-delete").each(function(){e(this).click(function(){var t=e(this).data().data;r.dao.attentionProduct({userId:r.util.getUserId(),productId:s[t].productId,colorId:s[t].productColorId,type:"2"},function(){b()})})}),e("#fav_item_list").show(),e("#fav_empty_wrap").hide()}else e("#fav_item_list").hide(),e("#fav_empty_wrap").show()})}function S(){r.dao.getCoupon({userId:r.util.getUserId(),currencyId:r.util.getLocalCurrency(),fromspc:0},function(t){if(t){q=t;for(var s=0;s<q.avas.length;s++){const i=q.avas[s].validtime;if(i&&i.length>0)for(var a=0;a<i.length;a++)i[a]=r.util.formatOrderDateTime(i[a]);else q.avas[s].validtime=""}for(var s=0;s<q.unavas.length;s++){const i=q.unavas[s].validtime;if(i&&i.length>0)for(var a=0;a<i.length;a++)i[a]=r.util.formatOrderDateTime(i[a]);else q.unavas[s].validtime=""}I(q.avas)}else e("#coupon_item_list").hide(),e("#coupon_empty_wrap").show()})}function I(t){t.length>0?(e("#coupon_item_list").html(""),e("#coupon_item_list").html(e("#couponItemTempl").tmpl(t)),e("#coupon_item_list .code-text").html(e.i18n.map.Code),e("#coupon_item_list .order-text").html(e.i18n.map.OrderValue),e("#coupon_item_list").show(),e("#coupon_empty_wrap").hide()):(e("#coupon_item_list").hide(),e("#coupon_empty_wrap").show())}function k(t,s){return!e(t).parent().hasClass("has-error")&&""!==e(t).val().trim()||(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e(s).css("visibility","visible"),!1)}function N(t,s){var i=document.getElementById("countryList");J=t||(sessionStorage.country_belong?sessionStorage.country_belong:i.options[0].value),e("#countryList option[value='"+J+"']").prop("selected","selected"),e.getJSON("/resources/json/country.json",function(t){V=t;var s=i.value;console.log(s);for(var r=0,a=0;a<t.length;a++){if(t[a].code===s){r=a;break}}if(t&&t[r]&&t[r].state&&t[r].state.length>0)T(t[r].state,!0),e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show()}e("#countryList").on("change",function(){var s=e(this).find("option:selected").val();J=s;var r=i.selectedIndex;if(t&&t[r]&&t[r].state&&t[r].state.length>0)T(t[r].state,!1),e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show()}})})}function T(t,s){if(t&&t.length>0){e("#provice_selected_wrap").show(),e("#provice_input_wrap").hide();var i=t;document.getElementById("provinceList").length=0;for(var r=0;r<i.length;r++){var a="<option value='"+i[r]+"'>"+i[r]+"</option>";s&&E&&E.province==i[r]&&(a="<option value='"+i[r]+"' selected>"+i[r]+"</option>"),e("#provinceList").append(a)}}else e("#provice_selected_wrap").hide(),e("#provice_input_wrap").show(),E&&e("#province_input").val(E.province)}function P(){e("#modify_information_success_message").hide();var t=r.util.getUserId();if(t){var s=e("input[type='radio'][name='gender']:checked").val();r.dao.userInfoModify({userId:t,sex:s,firstName:e("#account_setting_first_name_input").val(),lastName:e("#account_setting_last_name_input").val(),email:e("#account_setting_email_input").val()},function(t){var i=sessionStorage.getItem("userInfo");i&&(i=JSON.parse(i),i.sex=s,i.firstName=e("#account_setting_first_name_input").val(),i.lastName=e("#account_setting_last_name_input").val(),i.email=e("#account_setting_email_input").val(),sessionStorage.setItem("userInfo",JSON.stringify(i))),e("#modify_information_success_message").show()})}}function A(){e("#success_hint").addClass("hide"),document.getElementById("verify_email").disabled=!0;var t=r.util.getUserId();t&&r.dao.verifyEmail({userId:t,email:e("#email_verify_email_input").val()},function(t){e("#success_hint").removeClass("hide"),e("#verify_email").text(R+"S");var s=setInterval(function(){R>0?(R--,e("#verify_email").text(R+"S")):(e("#verify_email").text(e.i18n.map.VerifyBtn),document.getElementById("verify_email").disabled=!1,clearInterval(s))},1e3)})}function x(){var t=r.util.getUserId();t&&r.dao.mdpwd({userId:t,oldPwd:e("#modify_old_pwd_input").val(),newPwd:e("#modify_new_pwd_input").val(),checkCode:""},function(t){e("#modify_pwd_success_message").removeClass("alert-danger"),e("#modify_pwd_success_message").addClass("alert-success"),e("#modify_pwd_success_message").html(e.i18n.map.ModifyPwdSuccess),e("#modify_pwd_success_message").show()},function(t){e("#modify_pwd_success_message").removeClass("alert-success"),e("#modify_pwd_success_message").addClass("alert-danger"),e("#modify_pwd_success_message").html(t.msg),e("#modify_pwd_success_message").show()})}function O(){r.dao.logout({},function(){e("#login_btn i").removeClass("hide"),e("#login_btn img").addClass("hide"),sessionStorage.setItem("userId",""),sessionStorage.setItem("userInfo",""),sessionStorage.setItem("couponCode","");var t=r.util.encodeMenuType(r.util.getUvid());self!=top?window.parent.frames.location.href="./../../../login.html?u="+util.getQueryString("u")+"&uvid="+t:location.href="./../../../login.html?uvid="+t})}function B(e){if(V)for(var t=0;t<V.length;t++){var s=V[t];if(s.code==e)return s.name}return e}function M(){document.title=e.i18n.map.RecentlyBrowseTitle,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").show(),e("#my_comment_wrap").hide(),U()}function U(){var t=[];localStorage.currentBrowseList&&(t=JSON.parse(localStorage.currentBrowseList));var s={currencyId:r.util.getLocalCurrency(),products:t};r.dao.productsViewed({inputParams:JSON.stringify(s)},function(t){if(t&&t.length>0){var s=r.util.getCurrencySymbol(r.util.getLocalCurrency()),i=r.util.getAdvSource().u,a=r.util.encodeMenuType(r.util.getUvid());i||(i=r.util.getQueryString("u"));var n="";n=i?"?u="+i+"&uvid="+a:"?uvid="+a;for(var o=0;o<t.length;o++){var l=t[o];l.orgPrice=r.util.formatProductPrice(l.orgPrice,s),l.curPrice=r.util.formatProductPrice(l.curPrice,s),l.imgDisplay=r.util.picUrl+l.imgDisplay;var d=r.util.formatProductName(l.productName)+"-d-"+r.util.encodeMenuType(l.productId)+"-"+r.util.encodeMenuType(l.productColorId)+".html"+n;l.href=d}e("#recently_browse_list").html(e("#recentlyBrowseTempl").tmpl(t)),e("#recently_browse_wrap .empty-data").css("display","none")}else e("#recently_browse_wrap .empty-data").css("display","block")})}function L(){document.title=e.i18n.map.MyComment,e("#fav_list_wrap").hide(),e("#cart_list_wrap").hide(),e("#order_list_wrap").hide(),e("#coupons_list_wrap").hide(),e("#address_list_wrap").hide(),e("#account_setting_wrap").hide(),e("#recently_browse_wrap").hide(),e("#my_comment_wrap").show(),e("#my_comment_wrap .tab").removeClass("selected"),e("#my_comment_wrap .tab:first-child").addClass("selected"),D(1),e("#my_comment_wrap .tab").each(function(){e(this).click(function(){e("#my_comment_wrap .tab").removeClass("selected"),e(this).addClass("selected"),D(e(this).data().data+1)})})}function D(t){e("#my_comment_wrap .loading-my-comment").removeClass("hide"),e("#my_comment_wrap .my-comment-list-wrap").addClass("hide"),e("#my_comment_wrap .empty-data").addClass("hide"),r.dao.getMyCommentList({userId:r.util.getUserId(),type:t},function(s){if(s&&s.length>0){var i=r.util.getAdvSource().u,a=r.util.encodeMenuType(r.util.getUvid());i||(i=r.util.getQueryString("u"));var n="";n=i?"?u="+i+"&uvid="+a:"?uvid="+a;for(var o=0;o<s.length;o++){var l=s[o];l.mainImgpath=r.util.picUrl+l.mainImgpath,l.type=t,l.href=r.util.formatProductName(l.productName)+"-d-"+r.util.encodeMenuType(l.productId)+"-"+r.util.encodeMenuType(l.productColorId)+".html"+n}e("#my_comment_list").html(e("#myCommentTempl").tmpl(s)),e("#my_comment_list #color_title").html(e.i18n.map.ColorTitle),e("#my_comment_list #ToCommnet").html(e.i18n.map.ToCommnet),e("#my_comment_list #AdditionalCommnet").html(e.i18n.map.AdditionalCommnet),e("#my_comment_list #ViewComment").html(e.i18n.map.ViewComment),e("#my_comment_list #ProductDetailTitle").html(e.i18n.map.ProductDetailTitle),e("#my_comment_list #CommentRatingLabel").html(e.i18n.map.CommentRatingLabel),e("#my_comment_list #Opration").html(e.i18n.map.Opration),2!=t&&3!=t||e("#my_comment_list .comment-info-wrap input").each(function(){e(this).rating({step:1,size:"xs",showClear:!1,min:0,max:5,disabled:!0,showCaption:!1}).rating("showStars",e(this).data().data)}),e("#my_comment_wrap .loading-my-comment").addClass("hide"),e("#my_comment_wrap .my-comment-list-wrap").removeClass("hide"),e("#my_comment_wrap .empty-data").addClass("hide")}else e("#my_comment_wrap .loading-my-comment").addClass("hide"),e("#my_comment_wrap .my-comment-list-wrap").addClass("hide"),e("#my_comment_wrap .empty-data").removeClass("hide")},function(){e("#my_comment_wrap .loading-my-comment").addClass("hide"),e("#my_comment_wrap .my-comment-list-wrap").addClass("hide"),e("#my_comment_wrap .empty-data").removeClass("hide")})}var E,J,V=null,F=r.util.getQueryString("id"),Q=null,q=null;r.initLoginStatus(function(t){if(t){if(sessionStorage.userInfo){var s=JSON.parse(sessionStorage.userInfo);s.firstName?e("#name").text(s.firstName+s.lastName):s.email&&e("#name").text(s.email),n(s)}sessionStorage.commentSwitch&&"1"==sessionStorage.commentSwitch?e("#menu_my_comment").removeClass("hide"):e("#menu_my_comment").addClass("hide"),sessionStorage.messageSwitch&&"1"==sessionStorage.messageSwitch?e("#menu_my_message").removeClass("hide"):e("#menu_my_message").addClass("hide"),9==F?window.location.href="../../../my_message.html":8==F?(L(),e(".menu-list span").removeClass("selected"),e("#menu_my_comment").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.MyComment)):7==F?(M(),e(".menu-list span").removeClass("selected"),e("#menu_my_browse").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.RecentlyBrowseTitle)):6==F?(_(),e(".menu-list span").removeClass("selected"),e("#menu_account_setting").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.AccountSetting)):5==F?(u(),e(".menu-list span").removeClass("selected"),e("#menu_my_address").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.ManageAddressBook)):4==F?(m(),e(".menu-list span").removeClass("selected"),e("#menu_my_coupon").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.MyCoupons)):3==F?(c(),e(".menu-list span").removeClass("selected"),e("#menu_my_fav").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.MyFavorites)):2==F?(d(),e(".menu-list span").removeClass("selected"),e("#menu_my_cart").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.MyCart)):(l(),e(".menu-list span").removeClass("selected"),e("#menu_my_order").addClass("selected"),e(".menu-content-wrap .title").text(e.i18n.map.MyOrder))}else window.location.href="../../../login.html"}),function(){e(".menu-item-parent .menu-item-wrap").bind("click",function(){e(this).hasClass("selected")||(e(".menu-item-parent .menu-item-wrap").removeClass("selected"),e(this).addClass("selected"),e(".menu-content-wrap .title").text(e(this).text()),o(e(this)[0].id))}),e("#logout_btn").click(function(){O()}),e("#sava_base_information").click(function(){var e=!0;e=k("#account_setting_first_name_input","#account_setting_error_first_name")&&e,e=k("#account_setting_last_name_input","#account_setting_error_last_name")&&e,(e=k("#account_setting_email_input","#account_setting_error_email")&&e)&&P()}),e("#sava_new_pwd").click(function(){var t=!0;t=k("#modify_old_pwd_input","#old_pwd_error")&&t,t=k("#modify_new_pwd_input","#new_pwd_error")&&t,t=k("#modify_confirm_new_pwd_input","#confirm_new_pwd_error")&&t,e("#modify_new_pwd_input").val()!==e("#modify_confirm_new_pwd_input").val()&&(t=!1,e("#modify_pwd_success_message").removeClass("alert-success"),e("#modify_pwd_success_message").addClass("alert-danger"),e("#modify_pwd_success_message").html(e.i18n.map.PasswordNotMatch),e("#modify_pwd_success_message").show()),t&&x()}),e("#verify_email").click(function(){k("#email_verify_email_input","#email_verify_error_email")&&A()}),e("#add_new_addr_btn").click(function(){E=null;var t=sessionStorage.getItem("userInfo");t&&(t=JSON.parse(t),e("#first_name_input").val(t.firstName),e("#last_name_input").val(t.lastName),e("#email_input").val(t.email)),e("#address_input").val(""),e("#address_2_input").val(""),e("#city_input").val(""),e("#postal_code_input").val(""),e("#phone_input").val(""),e("#phone_2_input").val(""),e("#selected_province_span").text(""),e("#selected_country_span").text(""),e(".edit-address-mask").removeClass("hide"),N()}),e("#save_address_btn").click(function(){var t=!0,s=k("#first_name_input","#error_first_name");t&&((t=s&&t)||e("#first_name_input").focus());var i=k("#last_name_input","#error_last_name");t&&((t=i&&t)||e("#last_name_input").focus());var a=!0,n=r.util.checkAddress(e("#address_input").val());0==n?(e("#address_input").parent().removeClass("has-success"),e("#address_input").parent().addClass("has-error"),e("#error_address").css("visibility","visible"),a=!1):-1==n?(e("#address_input").parent().removeClass("has-success"),e("#address_input").parent().addClass("has-error"),e("#error_address").css("visibility","visible"),a=!1):1==n&&(e("#address_input").parent().removeClass("has-error"),e("#address_input").parent().addClass("has-success"),e("#error_address").css("visibility","hidden")),t&&((t=a&&t)||e("#address_input").focus()),a=!0,n=r.util.checkAddress(e("#address_2_input").val()),-1==n?(e("#address_2_input").parent().removeClass("has-success"),e("#address_2_input").parent().addClass("has-error"),e("#error_address_2").css("visibility","visible"),a=!1):(e("#address_2_input").parent().removeClass("has-error"),e("#address_2_input").parent().addClass("has-success"),e("#error_address_2").css("visibility","hidden")),t&&((t=a&&t)||e("#address_2_input").focus());var o=k("#city_input","#error_city");t&&((t=o&&t)||e("#city_input").focus());var l=k("#postal_code_input","#error_postal_code");t&&((t=l&&t)||e("#postal_code_input").focus());var d=k("#email_input","#error_email");t&&((t=d&&t)||e("#email_input").focus());var c=k("#phone_input","#error_phone");if(t&&((t=c&&t)||e("#phone_input").focus()),e("#provice_input_wrap").is(":visible")){var m=k("#province_input","#error_province");t&&((t=m&&t)||e("#province_input").focus())}var u=e("#provinceList").val();if(e("#provice_input_wrap").is(":visible")&&(u=e("#province_input").val()),t){var _={userId:r.util.getUserId(),country:J,fullCountry:B(J),province:u,city:e("#city_input").val(),streetAddr:e("#address_input").val(),extendAddr:e("#address_2_input").val(),email:e("#email_input").val().trim(),postCode:e("#postal_code_input").val(),isBillAddr:"0",telephone:e("#phone_input").val(),telephone1:e("#phone_2_input").val(),recFirstname:e("#first_name_input").val(),recLastname:e("#last_name_input").val()};E?(_.addrId=E.addrId,E.isBillAddr||(E.isBillAddr="0"),_.isBillAddr=E.isBillAddr,e("#default_input").get(0).checked?_.isDefault=1:_.isDefault=0,r.dao.updateAddress({inputParams:JSON.stringify(_)},function(t){e(".edit-address-mask").addClass("hide"),"1"==E.isBillAddr?p():v(),E=null})):r.dao.addAddress({inputParams:JSON.stringify(_)},function(t){e(".edit-address-mask").addClass("hide"),v()})}}),e("#cancel_save_address_btn").click(function(){e(".edit-address-mask").addClass("hide")}),e("#confirm_btn").click(function(){g()}),e("#customservice_btn").click(function(){e("#confirm_address_mask").addClass("hide"),r.util.getUserId()?window.location.href="../../../my_message.html?index=2":window.location.href="../../../login.html"}),e("#confirm_address_close_btn").click(function(){e("#confirm_address_mask").addClass("hide")})}(),function(){e("#account_setting_first_name_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#account_setting_error_first_name").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#account_setting_error_first_name").css("visibility","hidden"))}),e("#account_setting_last_name_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#account_setting_error_last_name").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#account_setting_error_last_name").css("visibility","hidden"))}),e("#account_setting_email_input").blur(function(){var t=r.util.checkEmail(e(this).val());console.log(t),1==t?(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#account_setting_error_email").css("visibility","hidden")):1!==t&&(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#account_setting_error_email").css("visibility","visible"))}),e("#modify_old_pwd_input").blur(function(){var t=r.util.checkPassword(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#old_pwd_error").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#old_pwd_error").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#old_pwd_error").css("visibility","hidden"))}),e("#modify_new_pwd_input").blur(function(){var t=r.util.checkPassword(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#new_pwd_error").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#new_pwd_error").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#new_pwd_error").css("visibility","hidden"))}),e("#modify_confirm_new_pwd_input").blur(function(){var t=r.util.checkPassword(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#confirm_new_pwd_error").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#confirm_new_pwd_error").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#confirm_new_pwd_error").css("visibility","hidden"))}),e("#first_name_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),
0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_first_name").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_first_name").css("visibility","hidden"))}),e("#last_name_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_last_name").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_last_name").css("visibility","hidden"))}),e("#address_input").blur(function(){var t=r.util.checkAddress(e(this).val());0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_address").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_address").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_address").css("visibility","hidden"))}),e("#address_2_input").blur(function(){-1==r.util.checkAddress(e(this).val())?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_address_2").css("visibility","visible")):(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_address_2").css("visibility","hidden"))}),e("#city_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_city").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_city").css("visibility","hidden"))}),e("#province_input").blur(function(){var t=r.util.checkNull(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_province").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_province").css("visibility","hidden"))}),e("#postal_code_input").blur(function(){var t=r.util.checkPhone(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_postal_code").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_postal_code").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_postal_code").css("visibility","hidden"))}),e("#email_input").blur(function(){var t=r.util.checkEmail(e(this).val().trim());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_email").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_email").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_email").css("visibility","hidden"))}),e("#phone_input").blur(function(){var t=r.util.checkPhone(e(this).val());console.log(t),0==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_phone").css("visibility","visible")):-1==t?(e(this).parent().removeClass("has-success"),e(this).parent().addClass("has-error"),e("#error_phone").css("visibility","visible")):1==t&&(e(this).parent().removeClass("has-error"),e(this).parent().addClass("has-success"),e("#error_phone").css("visibility","hidden"))})}();var R=60});