"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(t,e,a,i,l){function r(){l.dao.getFlashSaleFilter({flashId:c[g].flashId},function(e){c[g].filterData=e,c[g].filterData.tags&&c[g].filterData.tags.length>0?(t("#tags_list").html(t("#tagItemTempl").tmpl(c[g].filterData.tags)),t("#tags_list").removeClass("hide"),t("#tags_list .tags-item").click(function(){t(this).hasClass("selected")?t(this).removeClass("selected"):t(this).addClass("selected"),p=[];for(var e=t("#tags_list .tags-item.selected"),a=0;a<e.length;a++){const i=e[a];p.push({tagId:t(i).data().data,tagDes:t(i).text()})}s()})):t("#tags_list").addClass("hide")})}function s(){l.dao.getFlashSaleProduct({flashId:c[g].flashId,currencyId:l.util.getLocalCurrency(),currentPage:d.curPage,orderby:m,filterObj:JSON.stringify(o())},function(e){e.page?(d.amount=e.page.amount,d.pageSize=e.page.pageSize,d.curPage=e.page.curPage,t("#product_total_number").html(d.amount+" "+t.i18n.map.FlashSaleProductNumber),h=d.amount%d.pageSize==0?parseInt(d.amount/d.pageSize):parseInt(d.amount/d.pageSize)+1,n()):t("#product_total_number").html("0 "+t.i18n.map.FlashSaleProductNumber);var a=e.products;if(a&&a.length>0){var i=l.util.getCurrencySymbol(l.util.getLocalCurrency()),r=l.util.getAdvSource().u,s=l.util.encodeMenuType(l.util.getUvid());r||(r=l.util.getQueryString("u"));var o="";o=r?"?u="+r+"&uvid="+s:"?uvid="+s;for(var u=0;u<a.length;u++){var m=a[u];m.status=c[g].status;for(var p=0;p<m.display_data.length;p++){var f=m.display_data[p];f.original_price=l.util.formatProductPrice(f.original_price,i),f.current_price=l.util.formatProductPrice(f.current_price,i),f.img_display=l.util.picUrl+f.img_display,f.color_img=l.util.picUrl+f.color_img,f.height=l.util.getHomeImageHeight(),f.top=Number(l.util.getHomeImageHeight())-50,f.href=l.util.formatProductName(m.product_name)+"-d-"+l.util.encodeMenuType(m.product_id)+"-"+l.util.encodeMenuType(f.color_id)+".html"+o}1==m.status?m.desc=t.i18n.map.soldedHint.replace("$number",m.sold):m.desc=t.i18n.map.soldHint.replace("$number",m.limit)}t("#flash_sale_list").html(t("#flashSaleProductItemTempl").tmpl(a))}})}function o(){return{fiterAttr:[],tags:p}}function n(){t(function(){var e={bootstrapMajorVersion:1,currentPage:d.curPage,totalPages:h,shouldShowPage:!0,onPageClicked:function(a,i,l,r){d.curPage!==r&&(d.curPage=r,t("html").scrollTop(0),s(),e.currentPage=r)},onPageChanged:function(t,e,a){}};t("#flash_pagination").bootstrapPaginator(e)})}function u(){var e,a,i,l;f>=0&&(e=Math.floor(f/1e3/60/60/24),a=Math.floor(f/1e3/60/60%24),i=Math.floor(f/1e3/60%60),l=Math.floor(f/1e3%60),a+=24*e,a<10?t("#hour").text("0"+a):t("#hour").text(a),i<10?t("#minite").text("0"+i):t("#minite").text(i),l<10?t("#second").text("0"+l):t("#second").text(l),f-=1e3,setTimeout(u,1e3))}l.initLoginStatus();var c=null,g=-1,m=1,d={amount:0,curPage:1,pageSize:0},h=-1,p=[],f=0;t("#sort_method").html(t.i18n.map.SortRecommended),t("#sort_list li a").bind("click",function(){t("#sort_method").html(t(this)[0].text),d.curPage=1,m=Number(t(this)[0].id),d={amount:0,curPage:1,pageSize:0},t("#flash_sale_list").html(""),s()}),function(){l.dao.getFlashSaleSummary({},function(e){if(e&&e.length>0){for(var a=0;a<e.length;a++){const i=e[a];i.time=l.util.getTime(i.start),i.date=l.util.getDate(i.start)}t("#tabsList").html(t("#tabItemTempl").tmpl(e)),t("#tabsList .hint").html(t.i18n.map.EndsIn),t("#tabsList .hint1").html(t.i18n.map.ComingSoon),t(t("#tabsList").find(".tab-item")[0]).addClass("selected"),c=e,g=0,f=c[g].gap,u(),r(),s(),t("#tabsList .tab-item").click(function(){t(this).hasClass("selected")||(t(this).addClass("selected"),t(this).siblings().removeClass("selected"),g=t(this).index(),d={amount:0,curPage:1,pageSize:0},t("#tags_list").html(""),t("#flash_sale_list").html(""),r(),s())})}})}()});