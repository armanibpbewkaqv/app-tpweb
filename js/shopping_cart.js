"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common","bootstrapPaginator"],function(t,e,i,a,r,o){function n(){var e=t.i18n.map.FreeShippingTitle;e&&(e=e[0].replace("$price",sessionStorage.freeShippingAmount),t("#free_shipping_tab").html(e)),sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange?(t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide")):t("#recently_browser_tab").addClass("active")}function s(){r.dao.getCoupon({userId:r.util.getUserId(),currencyId:r.util.getLocalCurrency(),fromspc:1},function(e){if(e){if(e.avas&&e.avas.length>0){for(var i=e.avas,a=0;a<i.length;a++){const o=i[a].validtime;if(o&&o.length>0)for(var n=0;n<o.length;n++)o[n]=r.util.formatOrderDateTime(o[n]);else i[a].validtime="";r.util.getCouponCode()==i[a].code?i[a].selected=!0:i[a].selected=!1}t("#coupon_list_wrap").html(t("#avasCouponListTempl").tmpl(i)),t("#coupon_list_wrap .code-text").html(t.i18n.map.Code),t("#coupon_list_wrap .order-text").html(t.i18n.map.OrderValue),t("#coupon_list_wrap .disamount-text").html(t.i18n.map.disamountText),t("#coupon_list_wrap li").each(function(){t(this).unbind("click").click(function(e){e.stopPropagation();var i=t(this).data().data;t("#coupon_code_input").val(i),t(this).find("i").removeClass("icon-RadioButton"),t(this).find("i").addClass("icon-radio"),sessionStorage.setItem("couponCode",i),l(),s(),t("#coupon_wrap").addClass("hide")})})}else t("#coupon_list_wrap").html("");if(e.unavas&&e.unavas.length>0){for(var i=e.unavas,a=0;a<i.length;a++){const o=i[a].validtime;if(o&&o.length>0)for(var n=0;n<o.length;n++)o[n]=r.util.formatOrderDateTime(o[n]);else i[a].validtime="";r.util.getCouponCode()==i[a].code?i[a].selected=!0:i[a].selected=!1}t("#unavas_coupon_list_wrap").html(t("#unavasCouponListTempl").tmpl(i)),t("#unavas_coupon_list_wrap .code-text").html(t.i18n.map.Code),t("#unavas_coupon_list_wrap .order-text").html(t.i18n.map.OrderValue),t("#unavas_coupon_list_wrap .disamount-text").html(t.i18n.map.disamountText)}else t("#unavas_coupon_list_wrap").html("");0==e.unavas.length&&0==e.avas.length?t("#empty_coupon").removeClass("hide"):(tt=e.avas.length+e.unavas.length,D?(t("#apply_btn").text(t.i18n.map.Cancel),t("#apply_btn").css("background","#333")):tt?t("#apply_btn").text(t.i18n.map.CouponsNumber.replace("$number",tt)):t("#apply_btn").text(t.i18n.map.MyCoupons))}else t("#coupon_list_wrap").html(""),t("#unavas_coupon_list_wrap").html(""),t("#empty_coupon").removeClass("hide")})}function l(){D=!1;var e=r.util.getCouponCode();e&&("-1"!=e?t("#coupon_code_input").val(e):t("#coupon_code_input").val(""));var i={};r.util.checkIsLogin()?i={currencyId:r.util.getLocalCurrency(),userId:r.util.getUserId(),cart:[],applyCpNo:e}:localStorage.productList&&"[]"!==localStorage.productList?i={currencyId:r.util.getLocalCurrency(),userId:"",cart:JSON.parse(localStorage.productList),applyCpNo:e}:(i={currencyId:r.util.getLocalCurrency(),userId:"",cart:[],applyCpNo:e},t("#cart_cost_wrap").hide()),t("#point_value_input").val(sessionStorage.getItem("input_point")),i.withShipping="0",t("#point_value_input").val()&&Number(t("#point_value_input").val())>0&&(i.points=Number(t("#point_value_input").val()),sessionStorage.setItem("input_point",t("#point_value_input").val())),r.dao.shoppingCart({inputParams:JSON.stringify(i)},function(e){t(".loading-mask").addClass("hide"),e.applyCpNo?sessionStorage.setItem("couponCode",e.applyCpNo):sessionStorage.setItem("couponCode",""),"-1"!=sessionStorage.couponCode?t("#coupon_code_input").val(sessionStorage.couponCode):t("#coupon_code_input").val(""),e.cart&&e.cart.length>0?(t("#cart_list").show(),e.amount&&e.amount>0?t("#cart_cost_wrap").show():t("#cart_cost_wrap").hide(),t("#empty_cart").hide(),p(e),c(e),G||(G=!0,t.getJSON("/resources/json/country.json",function(t){}))):(t("#cart_cost_wrap").hide(),t("#cart_list").hide(),t("#empty_cart").show(),t("#product_total_number").html(0),t("#cart_product_number").html("0"),t("#cart_product_number").show(),t("#mb_cart_product_number").html("0"),t("#mb_cart_product_number").show(),t("#markup_product_wrap").addClass("hide")),t(".main-wrap").hasClass("invisibility")&&(t(".main-wrap").removeClass("invisibility"),t(".loading-mask").addClass("hide")),Y=e,Y.maxpoints||(Y.maxpoints=0),sessionStorage.getItem("input_point")&&Number(sessionStorage.getItem("input_point"))&&Number(sessionStorage.getItem("input_point"))>Number(Y.maxpoints)&&t("#point_value_input").val(Y.maxpoints),t("#max_point_value").text(t.i18n.map.MaxAvailable+" "+Y.maxpoints);var i=t.i18n.map.PointHint;i=i.replace("100%",Y.maxPointsPercent),t("#point_hint").attr("title",i)},function(){t(".loading-mask").addClass("hide")})}function p(e){var i=0,a=r.util.getCurrencySymbol(r.util.getLocalCurrency()),o=r.util.getAdvSource().u,n=r.util.encodeMenuType(r.util.getUvid());o||(o=r.util.getQueryString("u"));var s="";s=o?"?u="+o+"&uvid="+n:"?uvid="+n,$=[],Z=[];for(var l=0;l<e.cart.length;l++){var p=e.cart[l];if(p.displayImg=r.util.picUrl+p.displayImg,p.cost=r.util.formatProductPrice(p.cost,a),p.unitPrice=r.util.formatProductPrice(p.unitPrice,a),p.orgPrice&&(p.orgPrice=r.util.formatProductPrice(p.orgPrice,a)),i+=Number(p.productNum),p.prdAttrFlg&&"2"==p.prdAttrFlg){var c=r.util.formatProductName(p.productName)+"-d-"+r.util.encodeMenuType(p.productId)+"-"+r.util.encodeMenuType(p.productColorId)+".html"+s;p.href=c,Z.push(p)}else{var c=r.util.formatProductName(p.productName)+"-d-"+r.util.encodeMenuType(p.productId)+"-"+r.util.encodeMenuType(p.productColorId)+".html"+s;p.href=c,$.push(p)}if(p.subCarts&&p.subCarts.length>0)for(var u=0;u<p.subCarts.length;u++){var m=p.subCarts[u];m.attrDes&&m.attrDes.length>0?m.displayImg=r.util.picUrl+m.displayImg:(p.subCarts.splice(u,1),u-=1)}}t("#cart_list").html(t("#cartTempl").tmpl($)),t("#cart_list #color_title").html(t.i18n.map.ColorTitle),t("#cart_list #remove_label").html(t.i18n.map.Remove),t("#product_total_number").html(i),i>0?(t("#cart_product_number").html(i),t("#cart_product_number").show(),t("#mb_cart_product_number").html(i),t("#mb_cart_product_number").show()):(t("#cart_product_number").html("0"),t("#cart_product_number").show(),t("#mb_cart_product_number").html("0"),t("#mb_cart_product_number").show());var _=3;sessionStorage.maxnum_allowed&&(_=Number(sessionStorage.maxnum_allowed)),i<=_&&t("#error_message").addClass("hide");for(var l=0;l<$.length;l++)t("#qty_input_"+l).val($[l].productNum),t("#qty_input_"+l).blur(function(){t(this).val()||t(this).val(1),d(t(this).parent().parent().parent().data().data,Number(t(this).val()),e)}),t("#qty_input_"+l).on("input",function(){(t(this).val()?Number(t(this).val()):1)>99&&t(this).val(99)}),t("#"+l+" .remove-btn").each(function(){t(this).click(function(){console.log("del "+t(this).parent().parent().data().data+"item"),d(t(this).parent().parent().parent().parent().data().data,0,e)})});t("#cart_list .qty-content .icon--hao").click(function(){var i=t(this).next().val()?Number(t(this).next().val()):1;i>1&&(i-=1),t(this).next().val(i),d(t(this).parent().parent().parent().data().data,i,e)}),t("#cart_list .qty-content .icon-hao").click(function(){var i=t(this).prev().val()?Number(t(this).prev().val()):1;i<99&&(i+=1),t(this).prev().val(i),d(t(this).parent().parent().parent().data().data,i,e)});for(var l=0;l<e.dis_info.length;l++){var g=e.dis_info[l];g.disAmount<0?g.disAmount="-"+r.util.formatProductPrice(-g.disAmount,a):g.disAmount="+"+r.util.formatProductPrice(g.disAmount,a),8==g.policyId&&(D=!0)}if(t("#dis_info_list").html(t("#disInfoTempl").tmpl(e.dis_info)),sessionStorage.logistics_info?(t("#logistics_info").removeClass("hide"),t("#logistics_info").html(sessionStorage.logistics_info)):t("#logistics_info").addClass("hide"),D?(t("#apply_btn").text(t.i18n.map.Cancel),t("#apply_btn").css("background","#333")):(tt?t("#apply_btn").text(t.i18n.map.CouponsNumber.replace("$number",tt)):t("#apply_btn").text(t.i18n.map.MyCoupons),t("#apply_btn").css("background","#00aa00")),e.reachFreeShipping&&1==e.reachFreeShipping)t("#free_tip").css("color","#fff"),t("#free_tip").html(e.freeShippingInfo);else{t("#free_tip").css("color","#fff");var h=t.i18n.map.FreeShippingTip;if(h&&(h=h.replace("$price","<span style='color: #ea5455;'>"+e.freeShippingInfo+"</span>"),h=h.replace("$shippingchange",e.shippingCharge),h=h+"<span id='free_tip_add_more' class='free-tip-add-more'>"+t.i18n.map.AddFreeShipping+"</span>"),t("#free_tip").html(h),t("#free_tip_add_more").click(function(){t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide"),window.scrollTo(0,t("#free_shipping_tab").offset().top-150)}),sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange){var f=JSON.parse(sessionStorage.priceRange);f&&f.length>0&&t("#free_tip_add_more").css("display","inline-block")}else t("#free_tip_add_more").css("display","none")}t("#sub_total").html(r.util.formatProductPrice(e.amount,a)),t("#grand_total").html(r.util.formatProductPrice(e.realAmount,a)),e.cpPromptInfo?t("#coupon_use_info").html(e.cpPromptInfo):t("#coupon_use_info").html(""),J=e.realAmount,q=e.amountAllowed}function c(e){if(Z&&Z.length>0){t("#markup_product_wrap").removeClass("hide"),e.jgtitle&&("1"==e.reachjg?(t("#un_markup_tip").html(e.jgtitle),t("#un_markup_tip").removeClass("red"),t("#un_markup_tip").addClass("green")):(t("#un_markup_tip").html(e.jgtitle),t("#un_markup_tip").addClass("red"),t("#un_markup_tip").removeClass("green"))),t("#markup_product_list").html(t("#markupProductTempl").tmpl(Z));for(var i=0;i<Z.length;i++)Z[i].productNum<=10?t("#markup_qty_list_"+i+" option[value="+Z[i].productNum+"]").attr("selected","selected"):(t("#markup_qty_list_"+i).hide(),t("#markup_qty_list_"+i).parent().find("input").show(),t("#markup_qty_list_"+i).parent().find("input").val(Z[i].productNum)),Z[i].productNum>0?(t("#markup_product_list #markup_qty_list_"+i).prop("disabled",!1),t("#markup_product_list #"+i+" #add_btn i").addClass("selected")):(t("#markup_product_list #markup_qty_list_"+i).prop("disabled",!0),t("#markup_product_list #"+i+" #add_btn i").removeClass("selected")),"1"==Z[i].supportVideo?t("#play_btn_"+i).removeClass("hide"):t("#play_btn_"+i).addClass("hide"),t("#markup_product_list #"+i+" #add_btn i").each(function(){t(this).click(function(){var a=t(this).parent().parent().parent().data().data;t(this).hasClass("selected")?(t(this).removeClass("selected"),t("#markup_product_list #markup_qty_list_"+i).prop("disabled",!0),d(a+$.length,0,e)):(t(this).addClass("selected"),t("#markup_product_list #markup_qty_list_"+i).prop("disabled",!1),E.productName=Z[a].productName,E.productImage=Z[a].displayImg,E.productId=Z[a].productId,E.productColorId=Z[a].productColorId,E.prdAttrFlg="2",P())})}),t("#markup_product_list .qty-content select option[value=11]").html(t.i18n.map.MoreNumber),t("#markup_product_list .qty-content select").change(function(){if("11"==t(this).val())t(this).hide(),t(this).parent().find("input").show();else{var i=t(this).find("option:selected").text();d(t(this).parent().parent().data().data+$.length,i,e)}}),t("#markup_product_list .qty-content input").blur(function(){var i=t(this).val();d(t(this).parent().parent().data().data+$.length,i,e)})}}function d(e,i,a){if(r.util.checkIsLogin()){var o=a.cart[e];o.productNum=Number(i),o.userId=r.util.getUserId(),t(".loading-mask").removeClass("hide"),r.dao.shoppingCartMt({inputParams:JSON.stringify([o])},function(t){l(),s()})}else if(localStorage.productList){t(".loading-mask").removeClass("hide");var n=JSON.parse(localStorage.productList);if(0==Number(i))n.splice(e,1);else{var o=n[e];o.productNum=Number(i)}localStorage.setItem("productList",JSON.stringify(n)),l()}}function u(){var e=[];localStorage.currentBrowseList&&(e=JSON.parse(localStorage.currentBrowseList));var i={currencyId:r.util.getLocalCurrency(),products:e};r.dao.productsViewed({inputParams:JSON.stringify(i)},function(e){if(e&&e.length>0){e.length>10&&(e=e.slice(0,10));var i=r.util.getCurrencySymbol(r.util.getLocalCurrency()),a=r.util.getAdvSource().u,o=r.util.encodeMenuType(r.util.getUvid());a||(a=r.util.getQueryString("u"));var n="";n=a?"?u="+a+"&uvid="+o:"?uvid="+o;for(var s=0;s<e.length;s++){var l=e[s];if(l.orgPrice=r.util.formatProductPrice(l.orgPrice,i),l.curPrice=r.util.formatProductPrice(l.curPrice,i),l.imgDisplay=r.util.picUrl+l.imgDisplay,r.util.isMobile()){var p=460,c=r.util.getImageHeight(),d=(document.body.clientWidth-40)/3-10;l.height=parseInt(c*d/p)}else{var p=231,c=r.util.getImageHeight(),d=230;l.height=parseInt(c*d/p)}var u=r.util.formatProductName(l.productName)+"-d-"+r.util.encodeMenuType(l.productId)+"-"+r.util.encodeMenuType(l.productColorId)+".html"+n;l.href=u}t("#product_viewed_list_wrap").html(t("#productViewedListTempl").tmpl(e)),t("#recently_browse_wrap").find(".free-shpping-empty-data").addClass("hide")}else t("#recently_browse_wrap").find(".free-shpping-empty-data").removeClass("hide")})}function m(){if(sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange){var e=JSON.parse(sessionStorage.priceRange);e&&e.length>0&&_()}else t("#free_shipping_tab").addClass("hide"),t("#shipping_list_wrap").addClass("hide"),t("#recently_browse_wrap").removeClass("hide")}function _(){r.dao.catstinPriceArrange({currencyId:r.util.getLocalCurrency()},function(e){if(e&&0==e.length)return t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide"),void t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide");K=e;for(var i=0;i<K.length;i++){var a=K[i];a.cats&&a.cats[0]&&"FFFFFFFF"==a.cats[0].catid&&(a.cats[0].des=t.i18n.map.AllTitle)}t("#price_zone_list").html(t("#priceZoneTempl").tmpl(e)),t("#price_zone_list").find("li").eq(0).addClass("current"),t("#price_zone_list li").each(function(){t(this).click(function(){return t("#price_zone_list").find("li").removeClass("current"),t(this).addClass("current"),Q=t(this)[0].id,t("#price_zone_categoty_list").html(t("#priceZoneCategoryTempl").tmpl(K[Q].cats)),t("#price_zone_categoty_list").find(".category-item").eq(0).addClass("selected"),t("#price_zone_categoty_list .category-item").each(function(){t(this).click(function(){return g(t(this)),!1})}),W.curPage=1,X="FFFFFFFF",h(K[Q].from,K[Q].to,X),!1})}),t("#price_zone_categoty_list").html(t("#priceZoneCategoryTempl").tmpl(K[0].cats)),t("#price_zone_categoty_list").find(".category-item").eq(0).addClass("selected"),t("#price_zone_categoty_list .category-item").each(function(){t(this).click(function(){return g(t(this)),!1})}),X="FFFFFFFF",h(K[Q].from,K[Q].to,X)},function(){t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide"),t("#shipping_list_wrap").find("#page_wrap").addClass("hide"),t("#shipping_list_wrap").find("#shipping_list").addClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")})}function g(e){t("#price_zone_categoty_list .category-item").removeClass("selected"),e.addClass("selected");var i=e.data().data;X=i,W.curPage=1,h(K[Q].from,K[Q].to,i)}function h(e,i,a){t("#shipping_list_wrap .shipping-list-loading-data").removeClass("hide"),r.dao.productsByPriceRange({currencyId:r.util.getLocalCurrency(),currentPage:W.curPage,from:e,to:i,typeId:a},function(e){e.page&&(W.amount=e.page.amount,W.pageSize=e.page.pageSize);var i=e.products;if(i&&i.length>0){for(var a=r.util.getCurrencySymbol(r.util.getLocalCurrency()),o=0;o<i.length;o++){var n=i[o];if(n.original_price=r.util.formatProductPrice(n.original_price,a),n.current_price=r.util.formatProductPrice(n.current_price,a),n.img_display=r.util.picUrl+n.img_display,r.util.isMobile()){var s=460,l=r.util.getImageHeight(),p=(document.body.clientWidth-40)/3-10;n.height=parseInt(l*p/s)}else{var s=230,l=r.util.getImageHeight(),p=230;n.height=parseInt(l*p/s)}}t("#shipping_list").html(t("#shippingListTempl").tmpl(i)),t("#shipping_list .product-item").each(function(){t(this).click(function(){v(t(this)[0].id)})}),1==W.curPage&&f(),t("#shipping_list_wrap").find(".free-shpping-empty-data").addClass("hide"),t("#shipping_list_wrap").find("#page_wrap").removeClass("hide"),t("#shipping_list_wrap").find("#shipping_list").removeClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")}else t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide"),t("#shipping_list_wrap").find("#page_wrap").addClass("hide"),t("#shipping_list_wrap").find("#shipping_list").addClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")},function(){t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide"),t("#shipping_list_wrap").find("#page_wrap").addClass("hide"),t("#shipping_list_wrap").find("#shipping_list").addClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")})}function f(){var e=0;e=W.amount%W.pageSize==0?W.amount/W.pageSize:W.amount/W.pageSize+1,t(function(){var i={bootstrapMajorVersion:1,currentPage:W.curPage,numberOfPages:5,totalPages:e,shouldShowPage:!0,onPageClicked:function(e,a,r,o){W.curPage=o,h(K[Q].from,K[Q].to,X),i.currentPage=o,t("#page").bootstrapPaginator(i)}};t("#page").bootstrapPaginator(i)})}function v(e){r.dao.productDetail({productId:e,currencyId:r.util.getLocalCurrency()},function(e){if(e.product_id){E.productName=e.product_name,E.productId=e.product_id,E.prdAttrFlg="",E.color_data=e.color_data;for(var i=r.util.getCurrencySymbol(r.util.getLocalCurrency()),a=0;a<e.color_data.length;a++){var o=e.color_data[a];o.original_price=r.util.formatProductPrice(o.original_price,i),o.current_price=r.util.formatProductPrice(o.current_price,i),o.img_display=r.util.picUrl+o.img_display,o.color_img=r.util.picUrl+o.color_img,o.width=200,o.height=200;for(var n=0;n<o.img_groups.length;n++){var s=o.img_groups[n];s.small_img=r.util.picUrl+s.small_img,s.big_img=r.util.picUrl+s.big_img}}e.product_des?t(".description").html(e.product_des):t(".description").parent().parent().hide(),t("#name").html(e.color_data[U].pcName),t("#product_ext_name").html(e.color_data[U].pcNameExt),t("#current_price").html(e.color_data[U].current_price),t("#original_price").html(e.color_data[U].original_price),C(e.color_data),b(e.color_data[U].dyn_attrs),M(e.color_data[U].img_groups),t("#product_detail_mask").removeClass("hide"),t("#product_detail_mask #close_btn").click(function(){t("#product_detail_mask").addClass("hide")})}})}function C(e){1==e.length?(E.productColorId=e[0].color_id,t("#color_data_wrap").addClass("hide")):(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(e)),t(t("#color_list li")[U]).find("span").css("display","block"),t(t("#color_list li")[U]).find("img").addClass("selected-image-border"),t("#color_desc").html(e[U].color_des),E.productColorId=e[U].color_id,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var i=t(this).data().data;t("#color_desc").html(e[i].color_des),t("#name").html(e[i].pcName),t("#product_ext_name").html(e[i].pcNameExt),t("#current_price").html(e[i].current_price),t("#original_price").html(e[i].original_price),E.productColorId=e[i].color_id,M(e[i].img_groups)}}))}function b(e){V=!1,H=[],B=[],t("#customBtn").addClass("hide"),t("#attr_name_hint").html(t.i18n.map.PrintNameHint),t("#attr_number_hint").html(t.i18n.map.PrintNumberHint);for(var i=r.util.getCurrencySymbol(r.util.getLocalCurrency()),a=0;a<e.length;a++){var o=e[a];if(o.domain_list&&o.domain_list.length>0&&(t("#"+o.attr_name+"_content").html(o.domain_list[0]),o.selectedAttr=o.domain_list[0].optId,o.attr_name_id=y(o.attrID),"2"==o.attrID))for(var n=0;n<o.domain_list.length;n++){var s=o.domain_list[n];s.attrType=o.attrID,B.push(s)}o.input_cmp&&(H.push(o),V=!0,t("#customBtn").removeClass("hide")),"3"==o.attrID&&(t("#print_number_price").html("+"+r.util.formatProductPrice(o.input_cmp.price,i)),t("#detail_print_number_price").html("+"+r.util.formatProductPrice(o.input_cmp.price,i))),"4"==o.attrID&&(t("#print_name_price").html("+"+r.util.formatProductPrice(o.input_cmp.price,i)),t("#detail_print_name_price").html("+"+r.util.formatProductPrice(o.input_cmp.price,i)))}t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(e)),"0"==sessionStorage.size_guide||""==sessionStorage.size_guide?t("#size_guide").addClass("hide"):(t("#size_guide").html(t.i18n.map.SizeGuide),t("#size_guide").removeClass("hide")),V?t("#print_number_input")[0]||(t("#custom_wrap").removeClass("hide"),t("#custom_type_list").val(0),t("#custom_attrs_list").hide(),t("#custom_attrs_list").html(t("#customAttrsItem").tmpl(H))):t("#custom_wrap").addClass("hide"),t("#dyn_attrs_list input").blur(function(){var e=t(this).val();if(e<=10){var i=t(this).parent().find("select")[0].id;t("#custom_"+i+" option[value="+e+"]").prop("selected","selected")}else{var i=t(this).parent().find("select")[0].id,a="#"+i;t(a).hide(),t(a).parent().find("input").show(),t(a).parent().find("input").val(e)}})}function y(t){return t}function w(){j=S(),t("#custome_attr_list").html(""),t("#custome_attr_list").html(t("#customAttrItem").tmpl(j))}function I(){B&&B.length>0&&(t("#size_list").html(t("#customSizeItem").tmpl(B)),t("#size_list select option[value=11]").html(t.i18n.map.MoreNumber),w(),t("#size_list select").change(function(){console.log("#size_list select value = "+t(this).val()),t("#"+t(this)[0].id.substring(t(this)[0].id.indexOf("_")+1)+" option[value="+t(this).val()+"]").prop("selected","selected"),"11"==t(this).val()?(t(this).hide(),t(this).parent().find("input").show()):w()}),t("#size_list input").blur(function(){var e=t(this).val();if(e<=10){var i=t(this).parent().find("select")[0].id;t("#"+i.substring(i.indexOf("_")+1)+" option[value="+e+"]").prop("selected","selected")}else{var i=t(this).parent().find("select")[0].id,a="#"+i.substring(i.indexOf("_")+1);t(a).hide(),t(a).parent().find("input").show(),t(a).parent().find("input").val(e)}w()})),A()}function k(){I(),t("#custom_wrap_mask").removeClass("hide"),t("body").css("overflow","hidden")}function S(){for(var e=[],i=0;i<B.length;i++){var a=B[i],r=t("#"+a.optId+"_number_list").val();if("11"==r&&((r=t("#"+a.optId+"_number_list").parent().find("input").val())||(r=0)),a.number=r,Number(r)<=10?t("#custom_"+a.optId+"_number_list option[value="+r+"]").prop("selected","selected"):(t("#custom_"+a.optId+"_number_list").hide(),t("#custom_"+a.optId+"_number_list").parent().find("input").show(),t("#custom_"+a.optId+"_number_list").parent().find("input").val(r)),a.customs=[],r>0){for(var o=0;o<r;o++){for(var n=0;n<H.length;n++){H[n].position=o;var s=t("#print_input_"+a.optId+"_"+H[n].attrID+"_"+H[n].position).val();H[n].custominfo=s}a.customs.push(JSON.parse(JSON.stringify({attrs:H})))}e.push(a)}}return e}function N(){t("#custom_wrap_mask").addClass("hide"),t("body").css("overflow","auto")}function P(){var t=null;null!=(t=V?F():T())&&0!=t.length&&(r.util.checkIsLogin()?x(t):O(t))}function x(e){t(".loading-mask").removeClass("hide"),r.dao.merge2cart({inputParams:JSON.stringify(e)},function(){l(),s()},function(t){alert(t.msg)},function(e){t(".loading-mask").addClass("hide"),t("#product_detail_mask").addClass("hide")})}function O(e){t(".loading-mask").removeClass("hide");var i=localStorage.productList;if(i=i?JSON.parse(i):[],0==i.length)i=e;else for(var a=0;a<e.length;a++){for(var r=e[a],o=!1,n=JSON.stringify(r.attrOpts),p=0;p<i.length;p++){var c=i[p];c.productId==r.productId&&c.productColorId==r.productColorId&&n==JSON.stringify(c.attrOpts)&&(c.productNum=c.productNum+r.productNum,o=!0)}if(!o){i.push(r);for(var p=0;p<i.length;p++)"2"==i[p].prdAttrFlg&&(i.push(i[p]),i.splice(p,1))}}localStorage.productList=JSON.stringify(i);for(var d=0,p=0;p<i.length;p++)d=parseInt(d)+parseInt(i[p].productNum);t("#cart_product_number").html(d),t("#cart_product_number").show(),t("#mb_cart_product_number").html(d),t("#mb_cart_product_number").show(),t(".loading-mask").addClass("hide"),t("#product_detail_mask").addClass("hide"),l(),s()}function L(t){for(var e=0;e<t.length;e++)for(var i=t[e],a=JSON.stringify(i.attrOpts),r=e+1;r<t.length;r++){var o=t[r];a==JSON.stringify(o.attrOpts)&&(i.productNum=i.productNum+o.productNum,t.splice(r,1),r-=1)}return t}function F(){var e=[],i={userId:r.util.getUserId(),productName:E.productName,productId:E.productId,productColorId:E.productColorId,productNum:1,prdAttrFlg:E.prdAttrFlg,attrOpts:[{attrType:"",attrOptId:"",custominfo:""}]};if(j&&j.length>0)for(var a=0;a<j.length;a++)for(var o=j[a],n=0;n<o.customs.length;n++){for(var s=[{attrType:o.attrType,attrOptId:o.optId}],l=o.customs[n].attrs,p=0;p<l.length;p++){var c=l[p],d=t("#print_input_"+o.optId+"_"+c.attrID+"_"+c.position).val();s.push({attrType:c.attrID,attrOptId:c.input_cmp.optId,custominfo:d})}i.attrOpts=s,e.push(JSON.parse(JSON.stringify(i)))}return console.log(e),L(e)}function T(){for(var e=[],i={userId:r.util.getUserId(),productName:E.productName,productImage:E.productImage,productId:E.productId,productColorId:E.productColorId,prdAttrFlg:E.prdAttrFlg,productNum:1,attrOpts:[],attrString:""},a=null,o=0;o<E.color_data[0].dyn_attrs.length;o++){var n={},s=E.color_data[0].dyn_attrs[o];a=null==a?s.attr_name+": "+t("#"+y(s.attrID)+"_list").find("option:selected").text():a+","+s.attr_name+": "+t("#"+y(s.attrID)+"_list").find("option:selected").text(),n.attrType=s.attrID,n.attrOptId=t("#"+y(s.attrID)+"_list").val(),i.attrOpts.push(n)}return i.attrString=a,e.push(JSON.parse(JSON.stringify(i))),e}function A(){t("#custom_confirm_btn").unbind("click").click(function(){P()}),t("#custom_wrap_mask #close_btn, #custom_wrap_mask #custom_cancel_btn").unbind("click").click(function(){N()})}function M(e){t("#small_image_list").length>0&&t("#small_image_list").html(t("#productSmallImage").tmpl(e)),t("#small_image_list li:first").attr("id","onlickImg"),t("#vertical img:first").attr("src",e[0].big_img),-1==R.indexOf(e[0].big_img)&&t("#imageLoading").removeClass("hide"),z()}function z(){var e=null;t(document).ready(function(){t("#imageMenu li img").bind("click",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==R.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t("#imageMenu li").removeAttr("id"),t(this).parent().attr("id","onlickImg"))}).bind("mouseover",function(){"onlickImg"!=t(this).attr("id")&&(window.clearTimeout(e),t("#midimg").attr("src",t(this).data().data),-1==R.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"))}).bind("mouseout",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==R.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t(this).removeAttr("style"),e=window.setTimeout(function(){t("#midimg").attr("src",t("#onlickImg img").data().data),-1==R.indexOf(t("#onlickImg img").data().data)&&t("#imageLoading").removeClass("hide")},1e3))})})}var q="",J="",D=!1,U=0,E={productId:"",productColorId:""},R=[],B=[],j=[],H=[],V=!1,$=[],Z=[],Q=0,W={amount:0,curPage:1,pageSize:8},G=!1,K=[],X="",Y=null,tt=null;!function(){t(document).bind("click",function(){t("#coupon_wrap").addClass("hide")}),t("#coupon_wrap").bind("click",function(t){t.stopPropagation()}),t("#continue_shopping_btn").click(function(){window.location.href="/"}),t("#checkout_btn, #mobile_checkout_btn").click(function(){if(sessionStorage.delay_save&&"1"==sessionStorage.delay_save&&!t("#logistics_agree_input")[0].checked)return void alert(t.i18n.map.logisticsMessage6);var e=Number(t("#product_total_number").text()),i=3;if(sessionStorage.maxnum_allowed&&(i=Number(sessionStorage.maxnum_allowed)),e>i)t("#error_message").html(t.i18n.map.maxErrorMsg1+" "+i+t.i18n.map.maxErrorMsg2),t("#error_message").removeClass("hide"),setTimeout(function(){alert(t.i18n.map.maxErrorMsg1+" "+i+t.i18n.map.maxErrorMsg2)},1);else if(J>q){var a=r.util.getCurrencySymbol(r.util.getLocalCurrency());t("#error_message").html(t.i18n.map.maxAmountErrorMsg1+" "+r.util.formatProductPrice(J,a)+" "+t.i18n.map.maxAmountErrorMsg2+" "+r.util.formatProductPrice(q,a)+". "+t.i18n.map.maxAmountErrorMsg3),t("#error_message").removeClass("hide"),setTimeout(function(){alert(t.i18n.map.maxAmountErrorMsg1+" "+r.util.formatProductPrice(J,a)+" "+t.i18n.map.maxAmountErrorMsg2+" "+r.util.formatProductPrice(q,a)+". "+t.i18n.map.maxAmountErrorMsg3)},1)}else t("#error_message").addClass("hide"),r.util.checkIsLogin()?window.location.href="../../../checkout_shipping.html":window.location.href="../../../login.html"}),t("#apply_btn, #coupon_code_input").click(function(e){r.util.checkIsLogin()?D?(t("#coupon_code_input").val(""),sessionStorage.setItem("couponCode","-1"),t("#coupon_use_info").html(""),l(),s()):(t("#coupon_wrap").removeClass("hide"),e.stopPropagation()):window.location.href="../../../login.html"}),t("#point_value_input").on("input",function(e){0==Number(Y.maxpoints)?t(this).val(0):Number(t(this).val())>Number(Y.maxpoints)&&t(this).val(Y.maxpoints)}),t("#apply_point_btn").click(function(){t("#point_value_input").val()&&(sessionStorage.setItem("input_point",t("#point_value_input").val()),l(),s())}),t("#free_shipping_tab").click(function(){t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide")}),t("#recently_browser_tab").click(function(){t("#recently_browser_tab").addClass("active"),t("#free_shipping_tab").removeClass("active"),t("#shipping_list_wrap").addClass("hide"),t("#recently_browse_wrap").removeClass("hide")}),t("#midimg").load(function(e){console.log("big image loading"),t("#imageLoading").addClass("hide"),R.push(e.currentTarget.currentSrc)}),t("#addCartBtn").unbind("click").click(function(){console.log("addCartBtn"),P()}),t("#customBtn").click(function(){k()}),r.util.isMobile()&&t(window).scroll(function(){r.util.isElementInViewport(document.getElementById("checkout_btn"))?t("#mobile_checkout_btn").addClass("hide"):t("#mobile_checkout_btn").removeClass("hide")})}(),r.setLanguageCallback(function(){n(),l()}),r.setCurrencyCodeCallback(function(){n(),l(),u(),m(),s(),sessionStorage.delay_save&&"1"==sessionStorage.delay_save?(t("#logistics_message").removeClass("hide"),t("#logistics_agree_wrap").removeClass("hide")):(t("#logistics_message").addClass("hide"),t("#logistics_agree_wrap").addClass("hide"))}),r.initLoginStatus(function(e){r.util.getLocalCurrency()&&(l(),u(),m()),e?(t("#coupon_hint_wrap").addClass("hide"),t("#coupon_hint_wrap").attr("href","javascript:void(0)"),s()):(t("#coupon_hint_wrap").removeClass("hide"),t("#coupon_hint_wrap").attr("href","login.html"))})});